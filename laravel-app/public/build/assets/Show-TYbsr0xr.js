import{r as h,j as e,L as f,a as L}from"./app-DM5lWH7w.js";import{A as b,B as G}from"./Breadcrumb-DriWI8JK.js";import{B as a}from"./button-D_azY7HU.js";import{T as Q,a as R,b as B,c as l,d as V,e as d}from"./table-BGT-YAZs.js";import{C as x,a as m,b as o,c as p}from"./card-DjyVTpSh.js";import I from"./PurchaseOrderForm-DCyKIUlh.js";import{A as P}from"./arrow-left-D2uTfI0H.js";import{P as U}from"./printer-Br_SKlEC.js";import{S as X}from"./square-pen-BCmOeaAW.js";import{C as A}from"./circle-check-big-CYwe5r7P.js";import{C as z}from"./circle-x-2_s-kJ5P.js";import{f as J}from"./format-D9VrrLpI.js";import{v as W}from"./vi-DmPgEhae.js";import"./shopping-cart-CZJG6TeG.js";import"./index-H22tECQ6.js";import"./utils-De8wPBUk.js";import"./star-NL1IKTr_.js";import"./truck-PZjfZowP.js";import"./shopping-bag-D-8jhm6x.js";import"./users-Bg5QJiIM.js";import"./search-DZ4Pfh-R.js";import"./user-DrHZ__g_.js";import"./input-C9qzQYtQ.js";import"./textarea-V4QGxS2H.js";import"./dialog-_yQDYPAD.js";import"./index-v8iwHGUi.js";import"./index-ijvaBZ7a.js";import"./index-B4EdUvDt.js";import"./x-ToVJaZZw.js";import"./select-lTbdTkTd.js";import"./index-BeqeRdpr.js";import"./index-o3Sz-yc3.js";import"./check-Ct5f1nwX.js";import"./label-Dh85IkX1.js";import"./alert-cZJMHzEk.js";import"./calendar-D95ocz5F.js";import"./plus-DECCMGFS.js";import"./trash-2-Dy2jXSrq.js";function Ke({poId:i}){var w,C,k,T,_,S,H;const[D,j]=h.useState(!1),[s,F]=h.useState(null),[K,v]=h.useState(!0),$={pending:"Nháp",processing:"Đã đặt hàng",completed:"Đã nhận hàng",cancelled:"Đã hủy"},M={pending:"bg-gray-100 text-gray-800",processing:"bg-blue-100 text-blue-800",completed:"bg-green-100 text-green-800",cancelled:"bg-red-100 text-red-800"},g=async()=>{try{v(!0);const t=await L.get(`/api/v1/purchase-orders/${i}`);t.data&&t.data.data&&F(t.data.data)}catch(t){console.error("Lỗi khi tải đơn đặt hàng:",t)}finally{v(!1)}};h.useEffect(()=>{g()},[i]);const u=t=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(t),y=t=>t?J(new Date(t),"dd/MM/yyyy",{locale:W}):"",N=async t=>{var n,c;try{(await L.put(`/admin/purchase-orders/${i}/status`,{status:t})).data.status==="success"&&(g(),alert("Trạng thái đơn đặt hàng đã được cập nhật thành công"))}catch(r){console.error("Lỗi khi cập nhật trạng thái đơn đặt hàng:",r),alert(((c=(n=r.response)==null?void 0:n.data)==null?void 0:c.message)||"Lỗi khi cập nhật trạng thái đơn đặt hàng")}},E=()=>{window.print()},q=()=>{j(!1),g()},O=[{label:"Đơn đặt hàng",href:"/admin/purchase-orders"},{label:`Chi tiết đơn #${i}`,href:`/admin/purchase-orders/${i}`}];return K?e.jsxs(b,{children:[e.jsx(f,{title:"Đang tải..."}),e.jsx("div",{className:"container mx-auto py-6 px-4",children:e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"})})})]}):s?e.jsxs(b,{children:[e.jsx(f,{title:`Đơn đặt hàng #${s.po_id}`}),e.jsx("style",{children:`
                @media print {
                    /* Ẩn tất cả các phần khác khi in */
                    body * {
                        visibility: hidden;
                    }
                    /* Chỉ hiển thị phần nội dung cần in */
                    .print-content, .print-content * {
                        visibility: visible;
                    }
                    /* Định vị phần nội dung in ở vị trí đầu trang */
                    .print-content {
                        position: absolute;
                        left: 0;
                        top: 0;
                        width: 100%;
                    }
                    /* Hiển thị các phần chỉ dành cho in */
                    .print-only {
                        display: block !important;
                        visibility: visible;
                    }
                    /* Ẩn các nút không cần thiết khi in */
                    .no-print {
                        display: none !important;
                    }
                }
                /* Ẩn các phần chỉ dành cho in trong chế độ hiển thị thông thường */
                .print-only {
                    display: none;
                }
                `}),e.jsxs("div",{className:"container mx-auto py-6 px-4",children:[e.jsxs("div",{className:"no-print",children:[e.jsx(G,{items:O}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900",children:["Chi tiết đơn đặt hàng #",s.po_id]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(a,{variant:"outline",onClick:()=>window.location.href="/admin/purchase-orders",children:[e.jsx(P,{className:"mr-2 h-4 w-4"}),"Quay lại"]}),e.jsxs(a,{onClick:E,children:[e.jsx(U,{className:"mr-2 h-4 w-4"}),"In đơn"]}),s.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsxs(a,{variant:"outline",className:"bg-blue-50",onClick:()=>j(!0),children:[e.jsx(X,{className:"mr-2 h-4 w-4"}),"Chỉnh sửa"]}),e.jsxs(a,{className:"bg-blue-600 hover:bg-blue-700",onClick:()=>N("processing"),children:[e.jsx(A,{className:"mr-2 h-4 w-4"}),"Đặt hàng"]})]}),s.status==="processing"&&e.jsxs(e.Fragment,{children:[e.jsxs(a,{className:"bg-green-600 hover:bg-green-700",onClick:()=>N("completed"),children:[e.jsx(A,{className:"mr-2 h-4 w-4"}),"Nhận hàng"]}),e.jsxs(a,{variant:"destructive",onClick:()=>N("cancelled"),children:[e.jsx(z,{className:"mr-2 h-4 w-4"}),"Hủy đơn"]})]})]})]})]}),e.jsxs("div",{className:"print-content",children:[e.jsx("div",{className:"print-only mb-8",children:e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"HÓA ĐƠN NHẬP HÀNG"}),e.jsxs("p",{className:"text-gray-600",children:["Mã đơn: #",s.po_id]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs(x,{children:[e.jsx(m,{children:e.jsx(o,{children:"Thông tin đơn hàng"})}),e.jsx(p,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Mã đơn:"}),e.jsxs("span",{className:"font-medium",children:["#",s.po_id]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Ngày đặt:"}),e.jsx("span",{children:y(s.order_date)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Ngày dự kiến nhận:"}),e.jsx("span",{children:y(s.expected_date)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Trạng thái:"}),e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${M[s.status]}`,children:$[s.status]||s.status})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Người tạo:"}),e.jsx("span",{children:((w=s.created_by_user)==null?void 0:w.name)||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Ngày tạo:"}),e.jsx("span",{children:y(s.created_at)})]})]})})]}),e.jsxs(x,{children:[e.jsx(m,{children:e.jsx(o,{children:"Thông tin nhà cung cấp"})}),e.jsx(p,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Tên nhà cung cấp:"}),e.jsx("span",{className:"font-medium",children:(C=s.supplier)==null?void 0:C.name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Người liên hệ:"}),e.jsx("span",{children:(k=s.supplier)==null?void 0:k.contact_name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Điện thoại:"}),e.jsx("span",{children:(T=s.supplier)==null?void 0:T.phone})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Email:"}),e.jsx("span",{children:(_=s.supplier)==null?void 0:_.email})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Địa chỉ:"}),e.jsx("span",{className:"text-right",children:(S=s.supplier)==null?void 0:S.address})]})]})})]})]}),e.jsxs(x,{className:"mb-6",children:[e.jsx(m,{children:e.jsx(o,{children:"Chi tiết sản phẩm"})}),e.jsxs(p,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Q,{children:[e.jsx(R,{children:e.jsxs(B,{className:"bg-gray-50",children:[e.jsx(l,{className:"py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"#"}),e.jsx(l,{className:"py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Sản phẩm"}),e.jsx(l,{className:"py-3 px-6 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Số lượng"}),e.jsx(l,{className:"py-3 px-6 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Đơn giá"}),e.jsx(l,{className:"py-3 px-6 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Thành tiền"})]})}),e.jsx(V,{children:s.details&&s.details.map((t,n)=>{var c,r;return e.jsxs(B,{className:"hover:bg-gray-50",children:[e.jsx(d,{className:"py-4 px-6 text-sm text-gray-900",children:n+1}),e.jsxs(d,{className:"py-4 px-6 text-sm text-gray-900",children:["ID: ",t.product_id,((c=t.product)==null?void 0:c.name)&&e.jsx("span",{className:"block",children:t.product.name}),((r=t.product)==null?void 0:r.sku)&&e.jsxs("span",{className:"text-xs text-gray-500",children:["SKU: ",t.product.sku]})]}),e.jsx(d,{className:"py-4 px-6 text-sm text-gray-900 text-right",children:t.quantity}),e.jsx(d,{className:"py-4 px-6 text-sm text-gray-900 text-right",children:u(t.unit_price)}),e.jsx(d,{className:"py-4 px-6 text-sm text-gray-900 font-medium text-right",children:u(t.subtotal)})]},n)})})]})}),e.jsx("div",{className:"mt-6 flex flex-col items-end",children:e.jsxs("div",{className:"w-full max-w-md space-y-2",children:[e.jsxs("div",{className:"flex justify-between py-2",children:[e.jsx("span",{className:"text-gray-600",children:"Tổng số lượng:"}),e.jsx("span",{className:"font-medium",children:((H=s.details)==null?void 0:H.reduce((t,n)=>t+parseInt(n.quantity),0))||0})]}),e.jsxs("div",{className:"flex justify-between py-2 border-t border-gray-200",children:[e.jsx("span",{className:"text-gray-800 font-medium",children:"Tổng tiền:"}),e.jsx("span",{className:"font-bold text-lg",children:u(s.total_amount)})]})]})})]})]}),s.note&&e.jsxs(x,{className:"mb-6",children:[e.jsx(m,{children:e.jsx(o,{children:"Ghi chú"})}),e.jsx(p,{children:e.jsx("p",{className:"text-gray-700",children:s.note})})]}),e.jsx("div",{className:"print-only mt-8",children:e.jsxs("div",{className:"grid grid-cols-3 gap-6 text-center mt-20",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Người lập phiếu"}),e.jsx("p",{className:"text-xs text-gray-500",children:"(Ký, họ tên)"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Người giao hàng"}),e.jsx("p",{className:"text-xs text-gray-500",children:"(Ký, họ tên)"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Người nhận hàng"}),e.jsx("p",{className:"text-xs text-gray-500",children:"(Ký, họ tên)"})]})]})})]}),D&&e.jsx(I,{purchaseOrder:s,onClose:()=>j(!1),onSuccess:q})]})]}):e.jsxs(b,{children:[e.jsx(f,{title:"Không tìm thấy đơn đặt hàng"}),e.jsx("div",{className:"container mx-auto py-6 px-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Không tìm thấy đơn đặt hàng"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Đơn đặt hàng bạn đang tìm kiếm không tồn tại hoặc đã bị xóa."}),e.jsxs(a,{className:"mt-4",onClick:()=>window.location.href="/admin/purchase-orders",children:[e.jsx(P,{className:"mr-2 h-4 w-4"}),"Quay lại danh sách"]})]})})]})}export{Ke as default};
