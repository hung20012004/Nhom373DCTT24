import{K as R,r as m,j as e,L as E,$ as p,S as i}from"./app-DM5lWH7w.js";import{A as Q,B as X}from"./Breadcrumb-DriWI8JK.js";import{B as o}from"./button-D_azY7HU.js";import{I as b}from"./input-C9qzQYtQ.js";import{T as q,a as U,b as j,c as _,d as z,e as d}from"./table-BGT-YAZs.js";import G from"./OrderDialog-D4wcxNZs.js";import{A as J}from"./arrow-up-down-BlfunGSh.js";import"./shopping-cart-CZJG6TeG.js";import"./index-H22tECQ6.js";import"./utils-De8wPBUk.js";import"./star-NL1IKTr_.js";import"./truck-PZjfZowP.js";import"./shopping-bag-D-8jhm6x.js";import"./users-Bg5QJiIM.js";import"./search-DZ4Pfh-R.js";import"./user-DrHZ__g_.js";import"./dialog-_yQDYPAD.js";import"./index-v8iwHGUi.js";import"./index-ijvaBZ7a.js";import"./index-B4EdUvDt.js";import"./x-ToVJaZZw.js";import"./card-DjyVTpSh.js";import"./printer-Br_SKlEC.js";import"./format-D9VrrLpI.js";import"./vi-DmPgEhae.js";function fe({payments:n,summary:u,filters:r}){const{flash:l}=R().props,[a,C]=m.useState({type:(r==null?void 0:r.type)||"cod",status:(r==null?void 0:r.status)||"",start_date:(r==null?void 0:r.start_date)||"",end_date:(r==null?void 0:r.end_date)||"",search:(r==null?void 0:r.search)||""}),[S,T]=m.useState(!1),[y,k]=m.useState("created_at"),[N,v]=m.useState("desc"),[f,w]=m.useState(!1),[D,I]=m.useState(null),x=(t,s="vi-VN",g="VND")=>new Intl.NumberFormat(s,{style:"currency",currency:g,minimumFractionDigits:0}).format(t),h=t=>{C({...a,[t.target.name]:t.target.value})},O=t=>{t.preventDefault(),T(!0),i.get(route("admin.payments.index"),{...a,sort_field:y,sort_direction:N})},V=t=>{if(y===t){const s=N==="asc"?"desc":"asc";v(s),i.get(route("admin.payments.index"),{...a,sort_field:t,sort_direction:s})}else k(t),v("asc"),i.get(route("admin.payments.index"),{...a,sort_field:t,sort_direction:"asc"})},F=t=>{const s=prompt("Nhập ghi chú xác nhận thanh toán (nếu có):");i.post(route("admin.payments.confirm-cod",{paymentId:t}),{note:s||""})},B=t=>{const s=prompt("Nhập lý do từ chối thanh toán:");s&&i.post(route("admin.payments.reject-cod",t),{note:s})},L=t=>{confirm("Bạn có chắc chắn muốn xác minh thanh toán VNPay này?")&&i.post(route("admin.payments.verify-vnpay",t))},P=t=>{I(t),w(!0)},H=()=>{w(!1)},A=[{label:"Thanh toán",href:"/admin/payments"}],K=t=>{switch(t){case"paid":return"bg-yellow-100 text-yellow-800";case"confirmed":return"bg-green-100 text-green-800";case"pending":return"bg-blue-100 text-blue-800";case"rejected":return"bg-red-100 text-red-800";case"cancelled":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}},$=t=>{switch(t){case"paid":return"Đã thu tiền";case"confirmed":return"Đã xác nhận";case"pending":return"Chờ thanh toán";case"rejected":return"Đã từ chối";case"cancelled":return"Đã hủy";default:return t}},c=({field:t,children:s})=>e.jsx(_,{className:"py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer",onClick:()=>V(t),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:s}),e.jsx(J,{className:"w-4 h-4"})]})}),M=()=>!n.links||n.links.length<=3?null:n.links.map((t,s)=>s===0||s===n.links.length-1?null:e.jsx("div",{children:t.url?e.jsx(o,{variant:t.active?"default":"outline",className:"w-auto h-10",onClick:()=>i.get(t.url),dangerouslySetInnerHTML:{__html:t.label}}):e.jsx("span",{className:"px-3 py-2 text-gray-400",dangerouslySetInnerHTML:{__html:t.label}})},s));return e.jsxs(Q,{children:[e.jsx(E,{title:"Quản lý thanh toán"}),e.jsxs("div",{className:"container mx-auto py-6 px-4",children:[e.jsx(X,{items:A}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Quản lý thanh toán"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(p,{href:route("admin.payments.reconcile-vnpay"),children:e.jsx(o,{variant:"outline",className:"border-blue-600 text-blue-600 hover:bg-blue-50",children:"Đối soát VNPay"})}),e.jsx(p,{href:route("admin.payments.report"),children:e.jsx(o,{variant:"outline",className:"border-green-600 text-green-600 hover:bg-green-50",children:"Báo cáo"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white overflow-hidden shadow-sm rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Tổng số tiền"}),e.jsx("p",{className:"mt-1 text-2xl font-semibold text-indigo-600",children:x(u.total_amount)}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Không bao gồm đã hủy"})]}),e.jsxs("div",{className:"bg-white overflow-hidden shadow-sm rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Đã xác nhận"}),e.jsx("p",{className:"mt-1 text-2xl font-semibold text-green-600",children:x(u.confirmed_amount)}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Kế toán đã xác nhận"})]}),e.jsxs("div",{className:"bg-white overflow-hidden shadow-sm rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Chờ xác nhận"}),e.jsx("p",{className:"mt-1 text-2xl font-semibold text-yellow-600",children:x(u.pending_amount)}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Shipper đã thu tiền"})]}),e.jsxs("div",{className:"bg-white overflow-hidden shadow-sm rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Hôm nay"}),e.jsx("p",{className:"mt-1 text-2xl font-semibold text-blue-600",children:x(u.today_amount)})]})]}),e.jsx("div",{className:"bg-white overflow-hidden shadow-sm rounded-lg p-6 mb-6",children:e.jsx("form",{onSubmit:O,className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Loại thanh toán"}),e.jsxs("select",{name:"type",value:a.type,onChange:h,className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",children:[e.jsx("option",{value:"cod",children:"COD"}),e.jsx("option",{value:"vnpay",children:"VNPay"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Trạng thái"}),e.jsxs("select",{name:"status",value:a.status,onChange:h,className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",children:[e.jsx("option",{value:"",children:"Tất cả"}),e.jsx("option",{value:"pending",children:"Chờ thanh toán"}),e.jsx("option",{value:"paid",children:"Đã thu tiền"}),e.jsx("option",{value:"confirmed",children:"Đã xác nhận"}),e.jsx("option",{value:"rejected",children:"Đã từ chối"}),e.jsx("option",{value:"cancelled",children:"Đã hủy"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Từ ngày"}),e.jsx(b,{type:"date",name:"start_date",value:a.start_date,onChange:h})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Đến ngày"}),e.jsx(b,{type:"date",name:"end_date",value:a.end_date,onChange:h})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tìm kiếm"}),e.jsxs("div",{className:"flex rounded-md shadow-sm",children:[e.jsx(b,{type:"text",name:"search",value:a.search,onChange:h,placeholder:"Mã đơn hàng...",className:"rounded-l-md"}),e.jsx(o,{type:"submit",className:"rounded-l-none",children:"Tìm"})]})]})]})})}),e.jsx("div",{className:"bg-white overflow-hidden shadow-sm rounded-lg mb-6",children:e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"-mb-px flex",children:[e.jsx(p,{href:route("admin.payments.index",{type:"cod"}),className:`${a.type==="cod"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"} whitespace-nowrap py-4 px-6 border-b-2 font-medium text-sm`,children:"COD"}),e.jsx(p,{href:route("admin.payments.index",{type:"vnpay"}),className:`${a.type==="vnpay"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"} whitespace-nowrap py-4 px-6 border-b-2 font-medium text-sm`,children:"VNPay"})]})})}),l&&l.success&&e.jsx("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4",children:l.success}),l&&l.error&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:l.error}),e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(q,{children:[e.jsx(U,{children:e.jsxs(j,{className:"bg-gray-50",children:[e.jsx(c,{field:"order_id",children:"Mã đơn hàng"}),e.jsx(c,{field:"customer_name",children:"Khách hàng"}),e.jsx(c,{field:"amount",children:"Số tiền"}),e.jsx(c,{field:"payment_status",children:"Trạng thái"}),e.jsx(c,{field:"confirmed_by",children:"Người xác nhận"}),e.jsx(c,{field:"created_at",children:"Thời gian"}),e.jsx(_,{className:"py-3 px-6 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Thao tác"})]})}),e.jsx(z,{children:S?e.jsx(j,{children:e.jsx(d,{colSpan:7,className:"text-center py-4",children:e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-gray-900"})})})}):!n.data||n.data.length===0?e.jsx(j,{children:e.jsx(d,{colSpan:7,className:"text-center py-4 text-gray-500",children:"Không tìm thấy thanh toán nào"})}):n.data.map(t=>{var s,g;return e.jsxs(j,{className:"hover:bg-gray-50 transition-colors",children:[e.jsx(d,{className:"py-4 px-6 text-sm text-gray-900",children:t.order.order_id}),e.jsx(d,{className:"py-4 px-6 text-sm text-gray-900",children:((s=t.order.user)==null?void 0:s.name)||"N/A"}),e.jsx(d,{className:"py-4 px-6 text-sm text-gray-900 font-medium",children:x(t.amount)}),e.jsx(d,{className:"py-4 px-6 text-sm",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${K(t.payment_status)}`,children:$(t.payment_status)})}),e.jsx(d,{className:"py-4 px-6 text-sm text-gray-900",children:((g=t.confirmed_by)==null?void 0:g.name)||"-"}),e.jsx(d,{className:"py-4 px-6 text-sm text-gray-500",children:new Date(t.created_at).toLocaleDateString("vi-VN")}),e.jsx(d,{className:"py-4 px-6 text-sm text-gray-900",children:e.jsxs("div",{className:"flex justify-center gap-2",children:[t.payment_method==="cod"&&t.payment_status==="paid"&&e.jsxs(e.Fragment,{children:[e.jsx(o,{variant:"outline",className:"text-green-600 border-green-600 hover:bg-green-50",onClick:()=>F(t.payment_id),children:"Xác nhận"}),e.jsx(o,{variant:"outline",className:"text-red-600 border-red-600 hover:bg-red-50",onClick:()=>B(t.payment_id),children:"Từ chối"})]}),t.payment_method==="vnpay"&&t.payment_status==="pending"&&e.jsx(o,{variant:"outline",className:"text-blue-600 border-blue-600 hover:bg-blue-50",onClick:()=>L(t.payment_id),children:"Xác minh VNPay"}),e.jsx(o,{variant:"outline",className:"text-gray-600 border-gray-300 hover:bg-gray-50",onClick:()=>P(t.order.order_id),children:"Chi tiết"})]})})]},t.payment_id)})})]})}),n.links&&e.jsxs("div",{className:"flex justify-between items-center p-4 border-t",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Hiển thị ",n.from||0," đến ",n.to||0," trên ",n.total," kết quả"]}),e.jsx("div",{className:"flex gap-2",children:M()})]})]})]}),f&&e.jsx(G,{orderId:D,isOpen:f,onClose:H})]})}export{fe as default};
