import{r as a,j as e,L as ae,a as N}from"./app-DM5lWH7w.js";import{A as re,B as ne}from"./Breadcrumb-DriWI8JK.js";import{B as n}from"./button-D_azY7HU.js";import{I as C}from"./input-C9qzQYtQ.js";import{T as le,a as ie,b as v,c as B,d as ce,e as r}from"./table-BGT-YAZs.js";import{S as E,a as H,b as O,c as P,d as i}from"./select-lTbdTkTd.js";import oe from"./PurchaseOrderForm-DCyKIUlh.js";import{C as z}from"./calendar-D95ocz5F.js";import{E as de}from"./eye-CSKhNZ0e.js";import{S as he}from"./square-pen-BCmOeaAW.js";import{T as me}from"./trash-2-Dy2jXSrq.js";import{A as pe}from"./arrow-up-down-BlfunGSh.js";import{f as xe}from"./format-D9VrrLpI.js";import"./shopping-cart-CZJG6TeG.js";import"./index-H22tECQ6.js";import"./utils-De8wPBUk.js";import"./star-NL1IKTr_.js";import"./truck-PZjfZowP.js";import"./shopping-bag-D-8jhm6x.js";import"./users-Bg5QJiIM.js";import"./search-DZ4Pfh-R.js";import"./user-DrHZ__g_.js";import"./index-ijvaBZ7a.js";import"./index-v8iwHGUi.js";import"./index-BeqeRdpr.js";import"./index-o3Sz-yc3.js";import"./check-Ct5f1nwX.js";import"./textarea-V4QGxS2H.js";import"./dialog-_yQDYPAD.js";import"./index-B4EdUvDt.js";import"./x-ToVJaZZw.js";import"./label-Dh85IkX1.js";import"./alert-cZJMHzEk.js";import"./plus-DECCMGFS.js";function Je(){const[h,T]=a.useState([]),[I,k]=a.useState(!0),[m,A]=a.useState(""),[p,V]=a.useState("all"),[x,$]=a.useState("all"),[M,R]=a.useState([]),[u,q]=a.useState(""),[g,K]=a.useState(""),[Q,f]=a.useState(!1),[U,j]=a.useState(null),[c,D]=a.useState({current_page:1,per_page:10,total:0,last_page:1}),[b,G]=a.useState("order_date"),[w,L]=a.useState("desc"),J={pending:"Nháp",processing:"Đã đặt hàng",completed:"Đã nhận hàng",cancelled:"Đã hủy"},W={pending:"bg-gray-100 text-gray-800",processing:"bg-blue-100 text-blue-800",completed:"bg-green-100 text-green-800",cancelled:"bg-red-100 text-red-800"},X=async()=>{try{const t=await N.get("/api/v1/suppliers");t.data&&t.data.data&&R(t.data.data)}catch(t){console.error("Lỗi khi tải nhà cung cấp:",t)}},y=async()=>{try{k(!0);const t={};m&&m.trim()!==""&&(t.search=m.trim()),p!=="all"&&(t.status=p),x!=="all"&&(t.supplier_id=x),u&&(t.from_date=u),g&&(t.to_date=g),t.page=c.current_page,t.per_page=c.per_page,t.sort_field=b,t.sort_direction=w;const s=await N.get("/api/v1/purchase-orders",{params:t});s.data&&s.data.data&&(T(s.data.data.data),D({current_page:s.data.data.current_page,per_page:s.data.data.per_page,total:s.data.data.total,last_page:s.data.data.last_page}))}catch(t){console.error("Lỗi khi tải đơn đặt hàng:",t),T([])}finally{k(!1)}};a.useEffect(()=>{X()},[]),a.useEffect(()=>{const t=setTimeout(()=>{y()},300);return()=>clearTimeout(t)},[m,p,x,u,g,c.current_page,b,w]);const Y=t=>{b===t?L(w==="asc"?"desc":"asc"):(G(t),L("asc"))},Z=async t=>{var s,l;if(confirm("Bạn có chắc chắn muốn xóa đơn đặt hàng này không?"))try{(await N.delete(`/admin/purchase-orders/${t}`)).data.status==="success"&&(y(),alert("Đơn đặt hàng đã được xóa thành công"))}catch(d){console.error("Lỗi khi xóa đơn đặt hàng:",d),alert(((l=(s=d.response)==null?void 0:s.data)==null?void 0:l.message)||`Lỗi khi xóa đơn đặt hàng ${t}`)}},_=async(t,s)=>{var l,d;try{(await N.put(`/admin/purchase-orders/${t}/status`,{status:s})).data.status==="success"&&(y(),alert("Trạng thái đơn đặt hàng đã được cập nhật thành công"))}catch(S){console.error("Lỗi khi cập nhật trạng thái đơn đặt hàng:",S),alert(((d=(l=S.response)==null?void 0:l.data)==null?void 0:d.message)||"Lỗi khi cập nhật trạng thái đơn đặt hàng")}},ee=[{label:"Đơn đặt hàng",href:"/admin/purchase-orders"}],te=()=>{const t=[];for(let s=1;s<=c.last_page;s++)t.push(e.jsx(n,{variant:c.current_page===s?"default":"outline",className:"w-10 h-10",onClick:()=>D(l=>({...l,current_page:s})),children:s},s));return t},o=({field:t,children:s})=>e.jsx(B,{className:"py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer",onClick:()=>Y(t),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:s}),e.jsx(pe,{className:"w-4 h-4"})]})}),se=t=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(t),F=t=>t?xe(new Date(t),"dd/MM/yyyy"):"";return console.log("purchaseOrders typeof: ",typeof h.supplier_id),e.jsxs(re,{children:[e.jsx(ae,{title:"Quản lý đơn đặt hàng"}),e.jsxs("div",{className:"container mx-auto py-6 px-4",children:[e.jsx(ne,{items:ee}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Đơn đặt hàng"}),e.jsx("div",{className:"flex flex-col sm:flex-row gap-4 w-full sm:w-auto",children:e.jsx(n,{onClick:()=>{j(null),f(!0)},children:"Thêm đơn đặt hàng mới"})})]}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden mb-6",children:e.jsxs("div",{className:"p-4 grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsx("div",{children:e.jsx(C,{type:"text",placeholder:"Tìm kiếm đơn đặt hàng...",value:m,onChange:t=>A(t.target.value),className:"w-full"})}),e.jsx("div",{children:e.jsxs(E,{value:p,onValueChange:V,children:[e.jsx(H,{children:e.jsx(O,{placeholder:"Lọc theo trạng thái"})}),e.jsxs(P,{children:[e.jsx(i,{value:"all",children:"Tất cả trạng thái"}),e.jsx(i,{value:"pending",children:"Nháp"}),e.jsx(i,{value:"processing",children:"Đã đặt hàng"}),e.jsx(i,{value:"completed",children:"Đã nhận hàng"}),e.jsx(i,{value:"cancelled",children:"Đã hủy"})]})]})}),e.jsx("div",{children:e.jsxs(E,{value:x,onValueChange:$,children:[e.jsx(H,{children:e.jsx(O,{placeholder:"Lọc theo nhà cung cấp"})}),e.jsxs(P,{children:[e.jsx(i,{value:"all",children:"Tất cả nhà cung cấp"}),M.map(t=>e.jsx(i,{value:t.id,children:t.name},t.id))]})]})}),e.jsx("div",{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(z,{className:"h-4 w-4"}),e.jsx(C,{type:"date",value:u,onChange:t=>q(t.target.value),className:"w-full",placeholder:"Từ ngày"})]})}),e.jsx("div",{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(z,{className:"h-4 w-4"}),e.jsx(C,{type:"date",value:g,onChange:t=>K(t.target.value),className:"w-full",placeholder:"Đến ngày"})]})})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(le,{children:[e.jsx(ie,{children:e.jsxs(v,{className:"bg-gray-50",children:[e.jsx(o,{field:"po_id",children:"Mã đơn"}),e.jsx(o,{field:"supplier_id",children:"Nhà cung cấp"}),e.jsx(o,{field:"order_date",children:"Ngày đặt"}),e.jsx(o,{field:"expected_date",children:"Ngày dự kiến"}),e.jsx(o,{field:"total_amount",children:"Tổng tiền"}),e.jsx(o,{field:"status",children:"Trạng thái"}),e.jsx(B,{className:"py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Hành động"})]})}),e.jsx(ce,{children:I?e.jsx(v,{children:e.jsx(r,{colSpan:8,className:"text-center py-4",children:e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-gray-900"})})})}):!h||h.length===0?e.jsx(v,{children:e.jsx(r,{colSpan:8,className:"text-center py-4 text-gray-500",children:"Không có đơn đặt hàng nào"})}):h.map(t=>{var s;return e.jsxs(v,{className:"hover:bg-gray-50 transition-colors",children:[e.jsxs(r,{className:"py-4 px-6 text-sm text-gray-900 font-medium",children:["#",t.po_id]}),e.jsx(r,{className:"py-4 px-6 text-sm text-gray-900",children:((s=t.supplier)==null?void 0:s.name)||"N/A"}),e.jsx(r,{className:"py-4 px-6 text-sm text-gray-900",children:F(t.order_date)}),e.jsx(r,{className:"py-4 px-6 text-sm text-gray-900",children:F(t.expected_date)}),e.jsx(r,{className:"py-4 px-6 text-sm text-gray-900 font-medium",children:se(t.total_amount)}),e.jsx(r,{className:"py-4 px-6 text-sm",children:e.jsx("span",{className:`px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${W[t.status]}`,children:J[t.status]||t.status})}),e.jsx(r,{className:"py-4 px-6 text-sm text-gray-900",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{variant:"outline",size:"sm",className:"text-blue-600 hover:text-blue-700",onClick:()=>window.location.href=`/admin/purchase-orders/${t.po_id}`,children:e.jsx(de,{className:"h-4 w-4"})}),t.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx(n,{variant:"outline",size:"sm",className:"text-amber-600 hover:text-amber-700",onClick:()=>{console.log("Setting edit purchase order:",t),j(t),f(!0)},children:e.jsx(he,{className:"h-4 w-4"})}),e.jsx(n,{variant:"destructive",size:"sm",className:"bg-red-600 hover:bg-red-700 text-white",onClick:()=>Z(t.po_id),children:e.jsx(me,{className:"h-4 w-4"})})]}),t.status==="pending"&&e.jsx(n,{size:"sm",className:"bg-blue-600 hover:bg-blue-700 text-white",onClick:()=>_(t.po_id,"processing"),children:"Đặt hàng"}),t.status==="processing"&&e.jsxs(e.Fragment,{children:[e.jsx(n,{size:"sm",className:"bg-green-600 hover:bg-green-700 text-white",onClick:()=>_(t.po_id,"completed"),children:"Nhận hàng"}),e.jsx(n,{size:"sm",variant:"destructive",onClick:()=>_(t.po_id,"cancelled"),children:"Hủy"})]})]})})]},t.po_id)})})]})}),e.jsxs("div",{className:"flex justify-between items-center p-4 border-t",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Hiển thị ",h.length," trên ",c.total," đơn đặt hàng"]}),e.jsx("div",{className:"flex gap-2",children:te()})]})]}),Q&&e.jsx(oe,{purchaseOrder:U,onClose:()=>{f(!1),j(null)},onSuccess:()=>{f(!1),j(null),y()}})]})]})}export{Je as default};
