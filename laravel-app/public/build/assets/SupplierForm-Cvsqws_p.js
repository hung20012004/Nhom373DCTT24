import{r as m,j as e,a as j}from"./app-DM5lWH7w.js";import{D as S,a as U,b as R,c as T}from"./dialog-_yQDYPAD.js";import{B as N}from"./button-D_azY7HU.js";import{I as h}from"./input-C9qzQYtQ.js";import{L as c}from"./label-Dh85IkX1.js";import{T as O}from"./textarea-V4QGxS2H.js";import{A,a as I}from"./alert-cZJMHzEk.js";import{S as q}from"./switch-DrArOmrB.js";import"./index-v8iwHGUi.js";import"./utils-De8wPBUk.js";import"./index-ijvaBZ7a.js";import"./index-B4EdUvDt.js";import"./x-ToVJaZZw.js";import"./index-H22tECQ6.js";const P="supplier_logos",k="deczn9jtq";function ee({supplier:a,onClose:v,onSuccess:D}){const[s,o]=m.useState({name:"",contact_name:"",phone:"",email:"",address:"",description:"",logo_url:"",is_active:!0}),[u,f]=m.useState(!1),[r,_]=m.useState({}),[b,y]=m.useState(""),[l,g]=m.useState(null),[C,w]=m.useState(null);m.useEffect(()=>{a&&(o({name:a.name||"",contact_name:a.contact_name||"",phone:a.phone||"",email:a.email||"",address:a.address||"",description:a.description||"",logo_url:a.logo_url||"",is_active:a.is_active===1}),g(a.logo_url||null))},[a]);const F=t=>{const i=t.target.files[0];if(!i)return;const d=URL.createObjectURL(i);g(d),w(i)},E=async t=>{const i=new FormData;i.append("file",t),i.append("upload_preset",P);try{return(await j.post(`https://api.cloudinary.com/v1_1/${k}/image/upload`,i,{headers:{"Content-Type":"multipart/form-data"},withCredentials:!1})).data.secure_url}catch(d){throw console.error("Error uploading to Cloudinary:",d),new Error("Failed to upload image")}},L=async t=>{var i,d;t.preventDefault(),f(!0),_({}),y("");try{let n={...s};if(C){const x=await E(C);n.logo_url=x}else l?a&&(n.logo_url=a.logo_url):n.logo_url="";if(a){const x={};Object.keys(n).forEach(p=>{n[p]!==a[p]&&(x[p]=n[p])}),await j.post(`/admin/suppliers/${a.id}`,x)}else await j.post("/admin/suppliers",n);l&&l.startsWith("blob:")&&URL.revokeObjectURL(l),D()}catch(n){(d=(i=n.response)==null?void 0:i.data)!=null&&d.errors?_(n.response.data.errors):y("An error occurred while saving the supplier. Please try again."),console.error("Error submitting supplier:",n)}finally{f(!1)}};return e.jsx(S,{open:!0,onOpenChange:v,children:e.jsxs(U,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(R,{children:e.jsx(T,{children:a?"Cập nhật":"Thêm mới"})}),b&&e.jsx(A,{variant:"destructive",children:e.jsx(I,{children:b})}),e.jsxs("form",{onSubmit:L,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Logo"}),e.jsxs("div",{className:"flex items-center gap-4",children:[l&&e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:l,alt:"Preview",className:"w-24 h-24 object-cover rounded-lg"}),e.jsx("button",{type:"button",onClick:()=>{l.startsWith("blob:")&&URL.revokeObjectURL(l),g(null),w(null),o(t=>({...t,logo_url:""}))},className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center",children:"×"})]}),e.jsx(h,{type:"file",accept:"image/*",onChange:F,disabled:u})]}),r.logo_url&&e.jsx("span",{className:"text-red-500 text-sm",children:r.logo_url})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"name",children:"Tên"}),e.jsx(h,{id:"name",value:s.name,onChange:t=>o({...s,name:t.target.value}),required:!0}),r.name&&e.jsx("span",{className:"text-red-500 text-sm",children:r.name})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"contact_name",children:"Tên công ty"}),e.jsx(h,{id:"contact_name",value:s.contact_name,onChange:t=>o({...s,contact_name:t.target.value}),required:!0}),r.contact_name&&e.jsx("span",{className:"text-red-500 text-sm",children:r.contact_name})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"phone",children:"Số điện thoại"}),e.jsx(h,{id:"phone",value:s.phone,onChange:t=>o({...s,phone:t.target.value}),required:!0}),r.phone&&e.jsx("span",{className:"text-red-500 text-sm",children:r.phone})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"email",children:"Email"}),e.jsx(h,{id:"email",type:"email",value:s.email,onChange:t=>o({...s,email:t.target.value}),required:!0}),r.email&&e.jsx("span",{className:"text-red-500 text-sm",children:r.email})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"address",children:"Địa chỉ"}),e.jsx(h,{id:"address",value:s.address,onChange:t=>o({...s,address:t.target.value}),required:!0}),r.address&&e.jsx("span",{className:"text-red-500 text-sm",children:r.address})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"description",children:"Mô tả"}),e.jsx(O,{id:"description",value:s.description,onChange:t=>o({...s,description:t.target.value}),rows:4}),r.description&&e.jsx("span",{className:"text-red-500 text-sm",children:r.description})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(q,{id:"is_active",checked:s.is_active,onCheckedChange:t=>o({...s,is_active:t})}),e.jsx(c,{htmlFor:"is_active",children:"Đang hoạt động"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(N,{type:"button",variant:"outline",onClick:v,disabled:u,children:"Hủy"}),e.jsx(N,{type:"submit",disabled:u,className:"min-w-[100px]",children:u?"Đang lưu...":a?"Cập nhật":"Thêm mới"})]})]})]})})}export{ee as default};
