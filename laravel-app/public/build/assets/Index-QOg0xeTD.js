import{r as d,j as e,L as O,a as T}from"./app-DM5lWH7w.js";import{A as Q,B as Y}from"./Breadcrumb-DriWI8JK.js";import{B as b}from"./button-D_azY7HU.js";import{I as _}from"./input-C9qzQYtQ.js";import{C as q,a as F,b as G,c as J}from"./card-DjyVTpSh.js";import{B as D}from"./badge-D2PfSuDc.js";import{S as U,a as W,b as X,c as Z,d as f}from"./select-lTbdTkTd.js";import{D as ee,C as te,L as se,P as ae}from"./react-beautiful-dnd.esm-CceVe5Va.js";import{S as re}from"./search-DZ4Pfh-R.js";import{C as k}from"./calendar-D95ocz5F.js";import{E as ne}from"./eye-CSKhNZ0e.js";import{M as ie}from"./message-circle-Cm95Jnj2.js";import{f as le}from"./format-D9VrrLpI.js";import"./shopping-cart-CZJG6TeG.js";import"./index-H22tECQ6.js";import"./utils-De8wPBUk.js";import"./star-NL1IKTr_.js";import"./truck-PZjfZowP.js";import"./shopping-bag-D-8jhm6x.js";import"./users-Bg5QJiIM.js";import"./user-DrHZ__g_.js";import"./index-ijvaBZ7a.js";import"./index-v8iwHGUi.js";import"./index-BeqeRdpr.js";import"./index-o3Sz-yc3.js";import"./check-Ct5f1nwX.js";import"./tiny-invariant-BaFNuDhB.js";function Be(){const[m,y]=d.useState([]),[v,C]=d.useState(!0),[p,R]=d.useState(""),[u,L]=d.useState(""),[h,V]=d.useState(""),[x,K]=d.useState(""),[r,j]=d.useState({current_page:1,per_page:30,total:0,last_page:1}),N={new:"Mới",in_progress:"Đang xử lý",resolved:"Đã giải quyết",closed:"Đã đóng"},B={new:"bg-blue-100 text-blue-800",in_progress:"bg-yellow-100 text-yellow-800",resolved:"bg-green-100 text-green-800",closed:"bg-gray-100 text-gray-800"},E={shipping:"Vấn đề vận chuyển",product:"Vấn đề sản phẩm",payment:"Vấn đề thanh toán",other:"Khác"},P={shipping:"bg-indigo-100 text-indigo-800",product:"bg-purple-100 text-purple-800",payment:"bg-cyan-100 text-cyan-800",other:"bg-rose-100 text-rose-800"},S=async()=>{var t;try{C(!0);const s={};p&&p.trim()!==""&&(s.search=p.trim()),u&&(s.from_date=u),h&&(s.to_date=h),x&&x!=="all"&&(s.issue_type=x),s.page=r.current_page,s.per_page=r.per_page;const a=await T.get("/api/v1/support-requests",{params:s});a.data&&a.data.data&&(y(a.data.data.data),j({current_page:a.data.data.current_page,per_page:a.data.data.per_page,total:a.data.data.total,last_page:a.data.data.last_page})),console.log("Yêu cầu hỗ trợ:",a.data.data.data)}catch(s){console.error("Chi tiết lỗi:",((t=s.response)==null?void 0:t.data)||s.message||s),alert("Không thể tải dữ liệu. Vui lòng thử lại sau hoặc liên hệ quản trị viên."),y([])}finally{C(!1)}};d.useEffect(()=>{const t=setTimeout(()=>{S()},300);return()=>clearTimeout(t)},[p,u,h,x,r.current_page]);const M=async(t,s,a)=>{var l,n;try{return(await T.put(`/admin/support-requests/${t}/status`,{status:s})).data.status==="success"?(S(),alert("Trạng thái yêu cầu hỗ trợ đã được cập nhật thành công"),!0):!1}catch(i){console.error("Lỗi khi cập nhật trạng thái yêu cầu hỗ trợ:",i),alert(((n=(l=i.response)==null?void 0:l.data)==null?void 0:n.message)||"Lỗi khi cập nhật trạng thái yêu cầu hỗ trợ");const c=[...m],o=c.findIndex(g=>g.id.toString()===t);return o!==-1&&(c[o]={...c[o],status:a},y(c)),!1}},$=async t=>{const{destination:s,source:a,draggableId:l}=t;if(!(!s||s.droppableId===a.droppableId&&s.index===a.index)&&s.droppableId!==a.droppableId){const n=l,i=s.droppableId,c=a.droppableId,o=[...m],g=o.findIndex(A=>A.id.toString()===n);g!==-1&&(o[g]={...o[g],status:i},y(o)),await M(n,i,c)}},z=[{label:"Yêu cầu hỗ trợ",href:"/admin/support-requests"}],I=t=>t?le(new Date(t),"dd/MM/yyyy HH:mm"):"",w=m.reduce((t,s)=>{const a=s.status;return t[a]||(t[a]=[]),t[a].push(s),t},Object.keys(N).reduce((t,s)=>({...t,[s]:[]}),{})),H=({request:t,index:s})=>e.jsx(ae,{draggableId:t.id.toString(),index:s,children:(a,l)=>{var n;return e.jsx("div",{ref:a.innerRef,...a.draggableProps,...a.dragHandleProps,className:`mb-4 ${l.isDragging?"opacity-75":""}`,children:e.jsxs(q,{className:"hover:shadow-md transition-shadow",children:[e.jsxs(F,{className:"pb-2 flex flex-row justify-between items-center",children:[e.jsxs(G,{className:"text-sm font-semibold flex items-center",children:["#",t.id]}),e.jsx(D,{className:P[t.issue_type]||"bg-gray-100",children:E[t.issue_type]||t.issue_type})]}),e.jsxs(J,{className:"pt-0",children:[e.jsxs("div",{className:"text-sm mb-2",children:[e.jsx("div",{className:"font-medium truncate",children:((n=t.user)==null?void 0:n.name)||"Khách hàng"}),t.order_id&&e.jsxs("div",{className:"text-gray-500",children:[e.jsx("span",{className:"font-medium",children:"Đơn hàng:"})," #",t.order_id]}),e.jsx("div",{className:"text-gray-500",children:I(t.created_at)})]}),e.jsx("div",{className:"text-xs mt-2 max-h-12 overflow-hidden text-gray-600 line-clamp-2",children:t.description}),e.jsxs("div",{className:"flex justify-between items-center mt-3",children:[e.jsxs(b,{variant:"outline",size:"sm",className:"text-blue-600 hover:text-blue-700",onClick:()=>window.location.href=`/admin/support-requests/${t.id}`,children:[e.jsx(ne,{className:"h-4 w-4 mr-1"}),"Chi tiết"]}),e.jsxs("div",{className:"flex items-center text-gray-500 text-xs",children:[e.jsx(ie,{className:"h-3 w-3 mr-1"}),t.replies_count||0]})]}),t.resolved_at&&e.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:["Giải quyết: ",I(t.resolved_at)]})]})]})})}},t.id);return e.jsxs(Q,{children:[e.jsx(O,{title:"Quản lý yêu cầu hỗ trợ"}),e.jsxs("div",{className:"container mx-auto py-6 px-4",children:[e.jsx(Y,{items:z}),e.jsx("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Quản lý yêu cầu hỗ trợ"})}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden mb-6",children:e.jsxs("div",{className:"p-4 grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(re,{className:"h-4 w-4 text-gray-500"}),e.jsx(_,{type:"text",placeholder:"Tìm kiếm yêu cầu hỗ trợ...",value:p,onChange:t=>R(t.target.value),className:"w-full"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(k,{className:"h-4 w-4 text-gray-500"}),e.jsx(_,{type:"date",value:u,onChange:t=>L(t.target.value),className:"w-full",placeholder:"Từ ngày",max:h})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(k,{className:"h-4 w-4 text-gray-500"}),e.jsx(_,{type:"date",value:h,onChange:t=>V(t.target.value),className:"w-full",placeholder:"Đến ngày",min:u})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs(U,{value:x,onValueChange:K,children:[e.jsx(W,{className:"w-full",children:e.jsx(X,{placeholder:"Loại vấn đề"})}),e.jsxs(Z,{children:[e.jsx(f,{value:"all",children:"Tất cả"}),e.jsx(f,{value:"shipping",children:"Vấn đề vận chuyển"}),e.jsx(f,{value:"product",children:"Vấn đề sản phẩm"}),e.jsx(f,{value:"payment",children:"Vấn đề thanh toán"}),e.jsx(f,{value:"other",children:"Khác"})]})]})})]})}),v?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900"})}):e.jsx(ee,{onDragEnd:$,children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:Object.keys(N).map(t=>{var s;return e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"font-semibold text-gray-700",children:e.jsx("span",{className:`px-2 py-1 rounded-full ${B[t]}`,children:N[t]})}),e.jsx(D,{variant:"outline",className:"bg-white",children:((s=w[t])==null?void 0:s.length)||0})]}),e.jsx(te,{droppableId:t,children:(a,l)=>{var n;return e.jsxs("div",{ref:a.innerRef,...a.droppableProps,className:`space-y-2 overflow-y-auto max-h-[calc(100vh-250px)] min-h-64 p-2 rounded-lg ${l.isDraggingOver?"bg-gray-100":"bg-gray-50"}`,children:[((n=w[t])==null?void 0:n.length)===0?e.jsx("div",{className:"text-center py-8 text-gray-500 bg-white rounded-lg border border-dashed border-gray-300",children:e.jsx("p",{children:"Không có yêu cầu nào"})}):w[t].map((i,c)=>e.jsx(H,{request:i,index:c},i.id)),a.placeholder]})}})]},t)})})}),!v&&m.length>0&&r.last_page>1&&e.jsx("div",{className:"flex justify-center mt-6",children:e.jsxs("div",{className:"flex space-x-1",children:[e.jsx(b,{variant:"outline",size:"sm",disabled:r.current_page<=1,onClick:()=>j({...r,current_page:r.current_page-1}),children:"Trước"}),Array.from({length:r.last_page},(t,s)=>s+1).map(t=>e.jsx(b,{variant:r.current_page===t?"default":"outline",size:"sm",onClick:()=>j({...r,current_page:t}),children:t},t)),e.jsx(b,{variant:"outline",size:"sm",disabled:r.current_page>=r.last_page,onClick:()=>j({...r,current_page:r.current_page+1}),children:"Tiếp"})]})}),!v&&m.length===0&&e.jsxs("div",{className:"text-center py-12 bg-white rounded-lg shadow",children:[e.jsx(se,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-lg font-medium text-gray-900",children:"Không tìm thấy yêu cầu hỗ trợ"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Không có yêu cầu hỗ trợ nào phù hợp với các tiêu chí tìm kiếm."})]})]})]})}export{Be as default};
