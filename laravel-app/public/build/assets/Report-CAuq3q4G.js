import{K as S,r as N,j as e,L as B,$ as K,S as j}from"./app-DM5lWH7w.js";import{A as H,B as I}from"./Breadcrumb-DriWI8JK.js";import{B as m}from"./button-D_azY7HU.js";import{I as w}from"./input-C9qzQYtQ.js";import{T as E,a as P,b as x,d as R,e as r,c as V}from"./table-BGT-YAZs.js";import{R as A,L as O,C as M,X as Q,Y as X,T as Y,a as $,b as y}from"./LineChart-CoLp-pon.js";import"./shopping-cart-CZJG6TeG.js";import"./index-H22tECQ6.js";import"./utils-De8wPBUk.js";import"./star-NL1IKTr_.js";import"./truck-PZjfZowP.js";import"./shopping-bag-D-8jhm6x.js";import"./users-Bg5QJiIM.js";import"./search-DZ4Pfh-R.js";import"./user-DrHZ__g_.js";import"./tiny-invariant-BaFNuDhB.js";function oe({reportData:n,filters:l}){var b,f,v;const{flash:d}=S().props,[o,T]=N.useState({period:(l==null?void 0:l.period)||"day",start_date:(l==null?void 0:l.start_date)||"",end_date:(l==null?void 0:l.end_date)||""}),[h,C]=N.useState(!1),t=(s,a="vi-VN",g="VND")=>new Intl.NumberFormat(a,{style:"currency",currency:g,minimumFractionDigits:0}).format(s),u=s=>{T({...o,[s.target.name]:s.target.value})},_=s=>{s.preventDefault(),C(!0),j.get(route("admin.payments.report"),o)},k=[{label:"Quản lý",href:"/admin"},{label:"Thanh toán",href:"/admin/payments"},{label:"Báo cáo",href:"/admin/payments/report"}],F=()=>{if(!n||!n.cod||!n.vnpay)return[];const s={};return n.cod.forEach(a=>{s[a.period]||(s[a.period]={name:p(a.period),cod:0,vnpay:0,total:0}),s[a.period].cod=parseFloat(a.total||0),s[a.period].total+=parseFloat(a.total||0)}),n.vnpay.forEach(a=>{s[a.period]||(s[a.period]={name:p(a.period),cod:0,vnpay:0,total:0}),s[a.period].vnpay=parseFloat(a.total||0),s[a.period].total+=parseFloat(a.total||0)}),Object.values(s).sort((a,g)=>a.name.localeCompare(g.name))},p=s=>s,i=F(),c=({field:s,children:a})=>e.jsx(V,{className:"py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:e.jsx("div",{className:"flex items-center space-x-1",children:e.jsx("span",{children:a})})}),L=()=>!(n!=null&&n.links)||n.links.length<=3?null:n.links.map((s,a)=>a===0||a===n.links.length-1?s.url?e.jsx(m,{variant:"outline",className:"w-auto h-10",onClick:()=>j.get(s.url),dangerouslySetInnerHTML:{__html:s.label}},a):null:e.jsx("div",{children:s.url?e.jsx(m,{variant:s.active?"default":"outline",className:"w-auto h-10",onClick:()=>j.get(s.url),dangerouslySetInnerHTML:{__html:s.label}}):e.jsx("span",{className:"px-3 py-2 text-gray-400",dangerouslySetInnerHTML:{__html:s.label}})},a));return e.jsxs(H,{children:[e.jsx(B,{title:"Báo cáo thanh toán"}),e.jsxs("div",{className:"container mx-auto py-6 px-4",children:[e.jsx(I,{items:k}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Báo cáo thanh toán"}),e.jsx("div",{className:"flex space-x-2",children:e.jsx(K,{href:route("admin.payments.index"),children:e.jsx(m,{variant:"outline",className:"border-gray-600 text-gray-600 hover:bg-gray-50",children:"Quay lại"})})})]}),d&&d.success&&e.jsx("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4",children:d.success}),d&&d.error&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:d.error}),e.jsx("div",{className:"bg-white overflow-hidden shadow-sm rounded-lg p-6 mb-6",children:e.jsx("form",{onSubmit:_,className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Kỳ báo cáo"}),e.jsxs("select",{name:"period",value:o.period,onChange:u,className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",children:[e.jsx("option",{value:"day",children:"Theo ngày"}),e.jsx("option",{value:"week",children:"Theo tuần"}),e.jsx("option",{value:"month",children:"Theo tháng"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Từ ngày"}),e.jsx(w,{type:"date",name:"start_date",value:o.start_date,onChange:u})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Đến ngày"}),e.jsx(w,{type:"date",name:"end_date",value:o.end_date,onChange:u})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(m,{type:"submit",className:"w-full",disabled:h,children:h?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Đang tìm..."]}):"Tìm kiếm"})})]})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white overflow-hidden shadow-sm rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Tổng COD"}),e.jsx("p",{className:"mt-1 text-2xl font-semibold text-orange-600",children:t(((b=n==null?void 0:n.summary)==null?void 0:b.cod_total)||0)})]}),e.jsxs("div",{className:"bg-white overflow-hidden shadow-sm rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Tổng VNPay"}),e.jsx("p",{className:"mt-1 text-2xl font-semibold text-blue-600",children:t(((f=n==null?void 0:n.summary)==null?void 0:f.vnpay_total)||0)})]}),e.jsxs("div",{className:"bg-white overflow-hidden shadow-sm rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Tổng doanh thu"}),e.jsx("p",{className:"mt-1 text-2xl font-semibold text-green-600",children:t(((v=n==null?void 0:n.summary)==null?void 0:v.grand_total)||0)})]})]}),e.jsxs("div",{className:"bg-white overflow-hidden shadow-sm rounded-lg p-6 mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Biểu đồ doanh thu"}),e.jsx("div",{style:{width:"100%",height:400},children:i.length>0?e.jsx(A,{children:e.jsxs(O,{data:i,margin:{top:5,right:30,left:20,bottom:5},children:[e.jsx(M,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"name"}),e.jsx(X,{}),e.jsx(Y,{formatter:s=>t(s)}),e.jsx($,{}),e.jsx(y,{type:"monotone",dataKey:"cod",name:"COD",stroke:"#F97316",activeDot:{r:8}}),e.jsx(y,{type:"monotone",dataKey:"vnpay",name:"VNPay",stroke:"#2563EB"}),e.jsx(y,{type:"monotone",dataKey:"total",name:"Tổng",stroke:"#10B981",strokeWidth:2})]})}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("p",{className:"text-gray-500",children:"Không có dữ liệu để hiển thị"})})})]}),e.jsxs("div",{className:"bg-white overflow-hidden shadow-sm rounded-lg",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(E,{children:[e.jsx(P,{children:e.jsxs(x,{className:"bg-gray-50",children:[e.jsx(c,{field:"period",children:"Kỳ báo cáo"}),e.jsx(c,{field:"cod",children:"COD"}),e.jsx(c,{field:"vnpay",children:"VNPay"}),e.jsx(c,{field:"total",children:"Tổng"})]})}),e.jsx(R,{children:h?e.jsx(x,{children:e.jsx(r,{colSpan:4,className:"text-center py-4",children:e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-gray-900"})})})}):!i||i.length===0?e.jsx(x,{children:e.jsx(r,{colSpan:4,className:"text-center py-4 text-gray-500",children:"Không có dữ liệu báo cáo"})}):i.map((s,a)=>e.jsxs(x,{className:"hover:bg-gray-50 transition-colors",children:[e.jsx(r,{className:"py-4 px-6 text-sm text-gray-900",children:s.name}),e.jsx(r,{className:"py-4 px-6 text-sm text-gray-900",children:t(s.cod)}),e.jsx(r,{className:"py-4 px-6 text-sm text-gray-900",children:t(s.vnpay)}),e.jsx(r,{className:"py-4 px-6 text-sm text-gray-900 font-medium",children:t(s.total)})]},a))})]})}),(n==null?void 0:n.links)&&n.links.length>3&&e.jsxs("div",{className:"flex justify-between items-center p-4 border-t",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Hiển thị ",n.from||0," đến ",n.to||0," trên ",n.total," kết quả"]}),e.jsx("div",{className:"flex gap-2",children:L()})]})]})]})]})}export{oe as default};
