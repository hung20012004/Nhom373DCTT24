import{r as d,j as e,L as g,a as w}from"./app-DM5lWH7w.js";import{A as y,B as D}from"./Breadcrumb-DriWI8JK.js";import{B as h}from"./button-D_azY7HU.js";import{T as E,a as I,b as C,c as r,d as R,e as c}from"./table-BGT-YAZs.js";import{C as x,a as o,b as p,c as u}from"./card-DjyVTpSh.js";import U from"./InventoryCheckForm-DY8tp7yA.js";import{A as S}from"./arrow-left-D2uTfI0H.js";import{P as G}from"./printer-Br_SKlEC.js";import{S as O}from"./square-pen-BCmOeaAW.js";import{C as Q}from"./circle-check-big-CYwe5r7P.js";import{v as z}from"./vi-DmPgEhae.js";import{f as J}from"./format-D9VrrLpI.js";import"./shopping-cart-CZJG6TeG.js";import"./index-H22tECQ6.js";import"./utils-De8wPBUk.js";import"./star-NL1IKTr_.js";import"./truck-PZjfZowP.js";import"./shopping-bag-D-8jhm6x.js";import"./users-Bg5QJiIM.js";import"./search-DZ4Pfh-R.js";import"./user-DrHZ__g_.js";import"./dialog-_yQDYPAD.js";import"./index-v8iwHGUi.js";import"./index-ijvaBZ7a.js";import"./index-B4EdUvDt.js";import"./x-ToVJaZZw.js";import"./input-C9qzQYtQ.js";import"./label-Dh85IkX1.js";import"./textarea-V4QGxS2H.js";import"./select-lTbdTkTd.js";import"./index-BeqeRdpr.js";import"./index-o3Sz-yc3.js";import"./check-Ct5f1nwX.js";import"./plus-DECCMGFS.js";import"./trash-2-Dy2jXSrq.js";function qe({checkId:l}){var b,v;const[T,j]=d.useState(!1),[t,_]=d.useState(null),[L,N]=d.useState(!0),q={draft:"Nháp",completed:"Đã hoàn thành"},K={pending:"bg-gray-100 text-gray-800",completed:"bg-green-100 text-green-800"},f=async()=>{try{N(!0);const s=await w.get(`/api/v1/inventory-checks/${l}`);s.data&&s.data.data&&_(s.data.data),console.log(s.data.data)}catch(s){console.error("Lỗi khi tải phiếu kiểm kê:",s)}finally{N(!1)}};d.useEffect(()=>{f()},[l]);const k=s=>s?J(new Date(s),"dd/MM/yyyy",{locale:z}):"",$=async s=>{var n,a;try{(await w.put(`/admin/inventory-checks/${l}/status`,{status:s})).data.status==="success"&&(f(),alert("Trạng thái phiếu kiểm kê đã được cập nhật thành công"))}catch(i){console.error("Lỗi khi cập nhật trạng thái phiếu kiểm kê:",i),alert(((a=(n=i.response)==null?void 0:n.data)==null?void 0:a.message)||"Lỗi khi cập nhật trạng thái phiếu kiểm kê")}},P=()=>{window.print()},H=()=>{j(!1),f()},m=(s,n)=>n===0?0:(s/n*100).toFixed(2),B=()=>{if(!(t!=null&&t.details))return{totalSurplus:0,totalShortage:0};let s=0,n=0;return t.details.forEach(a=>{a.difference>0?s+=a.difference:a.difference<0&&(n+=Math.abs(a.difference))}),{totalSurplus:s,totalShortage:n}},F=[{label:"Kiểm kê kho",href:"/admin/inventory-checks"},{label:`Chi tiết phiếu #${l}`,href:`/admin/inventory-checks/${l}`}];if(L)return e.jsxs(y,{children:[e.jsx(g,{title:"Đang tải..."}),e.jsx("div",{className:"container mx-auto py-6 px-4",children:e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"})})})]});if(!t)return e.jsxs(y,{children:[e.jsx(g,{title:"Không tìm thấy phiếu kiểm kê"}),e.jsx("div",{className:"container mx-auto py-6 px-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Không tìm thấy phiếu kiểm kê"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Phiếu kiểm kê bạn đang tìm kiếm không tồn tại hoặc đã bị xóa."}),e.jsxs(h,{className:"mt-4",onClick:()=>window.location.href="/admin/inventory-checks",children:[e.jsx(S,{className:"mr-2 h-4 w-4"}),"Quay lại danh sách"]})]})})]});const{totalSurplus:M,totalShortage:A}=B();return e.jsxs(y,{children:[e.jsx(g,{title:`Phiếu kiểm kê #${t.check_id}`}),e.jsx("style",{children:`
                @media print {
                    /* Ẩn tất cả các phần khác khi in */
                    body * {
                        visibility: hidden;
                    }
                    /* Chỉ hiển thị phần nội dung cần in */
                    .print-content, .print-content * {
                        visibility: visible;
                    }
                    /* Định vị phần nội dung in ở vị trí đầu trang */
                    .print-content {
                        position: absolute;
                        left: 0;
                        top: 0;
                        width: 100%;
                    }
                    /* Hiển thị các phần chỉ dành cho in */
                    .print-only {
                        display: block !important;
                        visibility: visible;
                    }
                    /* Ẩn các nút không cần thiết khi in */
                    .no-print {
                        display: none !important;
                    }
                }
                /* Ẩn các phần chỉ dành cho in trong chế độ hiển thị thông thường */
                .print-only {
                    display: none;
                }
                `}),e.jsxs("div",{className:"container mx-auto py-6 px-4",children:[e.jsxs("div",{className:"no-print",children:[e.jsx(D,{items:F}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900",children:["Chi tiết phiếu kiểm kê #",t.check_id]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(h,{variant:"outline",onClick:()=>window.location.href="/admin/inventory-checks",children:[e.jsx(S,{className:"mr-2 h-4 w-4"}),"Quay lại"]}),t.status==="completed"&&e.jsxs(h,{onClick:P,children:[e.jsx(G,{className:"mr-2 h-4 w-4"}),"In phiếu"]}),t.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsxs(h,{variant:"outline",className:"bg-blue-50",onClick:()=>j(!0),children:[e.jsx(O,{className:"mr-2 h-4 w-4"}),"Chỉnh sửa"]}),e.jsxs(h,{className:"bg-green-600 hover:bg-green-700",onClick:()=>$("completed"),children:[e.jsx(Q,{className:"mr-2 h-4 w-4"}),"Hoàn thành"]})]})]})]})]}),e.jsxs("div",{className:"print-content",children:[e.jsx("div",{className:"print-only mb-8",children:e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"PHIẾU KIỂM KÊ KHO"}),e.jsxs("p",{className:"text-gray-600",children:["Mã phiếu: #",t.check_id]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs(x,{children:[e.jsx(o,{children:e.jsx(p,{children:"Thông tin phiếu kiểm kê"})}),e.jsx(u,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Mã phiếu:"}),e.jsxs("span",{className:"font-medium",children:["#",t.check_id]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Ngày kiểm kê:"}),e.jsx("span",{children:k(t.check_date)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Trạng thái:"}),e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${K[t.status]}`,children:q[t.status]||t.status})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Người tạo:"}),e.jsx("span",{children:((b=t.created_by_user)==null?void 0:b.name)||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Ngày tạo:"}),e.jsx("span",{children:k(t.created_at)})]})]})})]}),e.jsxs(x,{children:[e.jsx(o,{children:e.jsx(p,{children:"Tổng quan kiểm kê"})}),e.jsx(u,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Tổng sản phẩm kiểm kê:"}),e.jsx("span",{className:"font-medium",children:t.total_products||0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Tổng thừa:"}),e.jsxs("span",{className:"font-medium text-green-600",children:["+",M]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Tổng thiếu:"}),e.jsxs("span",{className:"font-medium text-red-600",children:["-",A]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Số sản phẩm có chênh lệch:"}),e.jsx("span",{className:"font-medium",children:((v=t.details)==null?void 0:v.filter(s=>s.difference!==0).length)||0})]})]})})]})]}),e.jsxs(x,{className:"mb-6",children:[e.jsx(o,{children:e.jsx(p,{children:"Chi tiết kiểm kê"})}),e.jsx(u,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(E,{children:[e.jsx(I,{children:e.jsxs(C,{className:"bg-gray-50",children:[e.jsx(r,{className:"py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"#"}),e.jsx(r,{className:"py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Sản phẩm"}),e.jsx(r,{className:"py-3 px-6 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"SL hệ thống"}),e.jsx(r,{className:"py-3 px-6 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"SL thực tế"}),e.jsx(r,{className:"py-3 px-6 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Chênh lệch"}),e.jsx(r,{className:"py-3 px-6 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"% Chênh lệch"})]})}),e.jsx(R,{children:t.details&&t.details.map((s,n)=>{var a,i;return e.jsxs(C,{className:`hover:bg-gray-50 ${s.difference!==0?"bg-yellow-50":""}`,children:[e.jsx(c,{className:"py-4 px-6 text-sm text-gray-900",children:n+1}),e.jsxs(c,{className:"py-4 px-6 text-sm text-gray-900",children:["ID: ",s.product_id,((a=s.product)==null?void 0:a.name)&&e.jsx("span",{className:"block",children:s.product.name}),((i=s.product)==null?void 0:i.sku)&&e.jsxs("span",{className:"text-xs text-gray-500",children:["SKU: ",s.product.sku]})]}),e.jsx(c,{className:"py-4 px-6 text-sm text-gray-900 text-right",children:s.system_quantity}),e.jsx(c,{className:"py-4 px-6 text-sm text-gray-900 text-right",children:s.actual_quantity}),e.jsxs(c,{className:`py-4 px-6 text-sm text-right font-medium ${s.difference>0?"text-green-600":s.difference<0?"text-red-600":"text-gray-900"}`,children:[s.difference>0?"+":"",s.difference]}),e.jsxs(c,{className:`py-4 px-6 text-sm text-right ${m(s.difference,s.system_quantity)>0?"text-green-600":m(s.difference,s.system_quantity)<0?"text-red-600":"text-gray-900"}`,children:[m(s.difference,s.system_quantity)>0?"+":"",m(s.difference,s.system_quantity),"%"]})]},n)})})]})})})]}),t.note&&e.jsxs(x,{className:"mb-6",children:[e.jsx(o,{children:e.jsx(p,{children:"Ghi chú"})}),e.jsx(u,{children:e.jsx("p",{className:"text-gray-700",children:t.note})})]}),e.jsx("div",{className:"print-only mt-8",children:e.jsxs("div",{className:"grid grid-cols-2 gap-6 text-center mt-20",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Người kiểm kê"}),e.jsx("p",{className:"text-xs text-gray-500",children:"(Ký, họ tên)"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Người quản lý kho"}),e.jsx("p",{className:"text-xs text-gray-500",children:"(Ký, họ tên)"})]})]})})]}),T&&e.jsx(U,{inventoryCheck:t,onClose:()=>j(!1),onSuccess:H})]})]})}export{qe as default};
