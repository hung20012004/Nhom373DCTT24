import{j as e,K as U,r,a as T,u as ee,b as G}from"./app-DM5lWH7w.js";import{D as se,a as te}from"./dialog-_yQDYPAD.js";import{A as L,a as V}from"./alert-cZJMHzEk.js";import{S as Q,C as K,a as X}from"./star-NL1IKTr_.js";import{C as ae}from"./circle-alert-DyacK_RC.js";import{c as B}from"./index-H22tECQ6.js";import{X as ie}from"./x-ToVJaZZw.js";import{M as le,H as J}from"./Layout-DVh4xpEi.js";import{P as ne}from"./plus-DECCMGFS.js";import{S as Y}from"./shopping-cart-CZJG6TeG.js";/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=B("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=B("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]),Z=({price:s,salePrice:g})=>{const h=u=>isNaN(u)?"N/A":new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(u);return g?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-300 line-through",children:h(s)}),e.jsx("span",{className:"text-red-400 font-semibold",children:h(g)})]}):e.jsx("span",{className:"text-gray-100",children:h(s)})},ce=()=>e.jsx("span",{className:"absolute top-4 left-4 px-2 py-1 text-xs font-semibold text-white bg-red-500 rounded-full",children:"Out of Stock"}),de=({productId:s,variant:g})=>{const{auth:h}=U().props,[u,N]=r.useState(0),[f,b]=r.useState(0),[o,y]=r.useState(""),[l,p]=r.useState(!1),[x,m]=r.useState(null),[C,w]=r.useState(!1),[c,d]=r.useState(null),[I,W]=r.useState([]),[j,M]=r.useState({averageRating:0,totalReviews:0,ratingCounts:{1:0,2:0,3:0,4:0,5:0}});r.useEffect(()=>{s&&(A(),h.user&&E())},[s,h.user]);const A=async()=>{try{const a=await T.get(`/products/${s}/reviews`);a.data.success&&(W(a.data.reviews),M(a.data.stats))}catch(a){console.error("Error fetching reviews:",a)}},E=async()=>{try{const a=await T.get(`/products/${s}/reviews/user`);a.data.success&&a.data.review&&(d(a.data.review),N(a.data.review.rating),y(a.data.review.comment))}catch(a){console.error("Error fetching user review:",a)}},$=async a=>{var v,P;if(a.preventDefault(),!h.user){m("Vui lòng đăng nhập để đánh giá sản phẩm!");return}if(u===0){m("Vui lòng chọn số sao đánh giá!");return}p(!0),m(null);try{const R=c?`/products/${s}/reviews/${c.review_id}`:`/products/${s}/reviews`,k=await T[c?"put":"post"](R,{rating:u,comment:o,variant_id:(g==null?void 0:g.variant_id)||null});k.data.success?(w(!0),A(),c||E(),setTimeout(()=>{w(!1)},3e3)):m(k.data.message||"Đã xảy ra lỗi khi gửi đánh giá")}catch(R){m(((P=(v=R.response)==null?void 0:v.data)==null?void 0:P.message)||"Đã xảy ra lỗi khi gửi đánh giá")}finally{p(!1)}},S=(a,v=!1,P="")=>[...Array(5)].map((R,D)=>{const k=D+1;return e.jsx("button",{type:"button",className:`${v?"cursor-pointer":"cursor-default"} focus:outline-none`,onClick:()=>v&&N(k),onMouseEnter:()=>v&&b(k),onMouseLeave:()=>v&&b(0),children:e.jsx(Q,{className:`w-6 h-6 ${k<=(v&&f||a)?"text-yellow-400 fill-yellow-400":"text-gray-300"}`})},`${P}-star-${D}`)}),i=a=>{const v={year:"numeric",month:"short",day:"numeric"};return new Date(a).toLocaleDateString("vi-VN",v)},_=a=>j.totalReviews===0?0:a/j.totalReviews*100;return e.jsxs("div",{className:"bg-white rounded-lg border p-4 mt-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Đánh giá sản phẩm"}),j.totalReviews>0&&e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg mb-6",children:e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-gray-900",children:j.averageRating.toFixed(1)}),e.jsx("div",{className:"flex justify-center mt-1",children:S(j.averageRating,!1,"stats")}),e.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:[j.totalReviews," đánh giá"]})]}),e.jsx("div",{className:"flex-1",children:[5,4,3,2,1].map(a=>e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:"text-sm font-medium w-2",children:a}),e.jsx(Q,{className:"w-4 h-4 text-yellow-400"}),e.jsx("div",{className:"flex-1 h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-yellow-400 rounded-full",style:{width:`${_(j.ratingCounts[a])}%`}})}),e.jsxs("div",{className:"text-xs text-gray-500 w-10",children:[j.ratingCounts[a]," đánh giá"]})]},a))})]})}),e.jsxs("form",{onSubmit:$,className:"mb-6",children:[x&&e.jsxs(L,{variant:"destructive",className:"mb-4",children:[e.jsx(ae,{className:"h-4 w-4"}),e.jsx(V,{children:x})]}),C&&e.jsx(L,{className:"mb-4 bg-green-50 text-green-700 border-green-200",children:e.jsx(V,{children:"Đánh giá của bạn đã được gửi thành công!"})}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Đánh giá của bạn"}),e.jsxs("div",{className:"flex items-center",children:[S(u,!0,"user-rating"),e.jsx("span",{className:"ml-2 text-sm text-gray-500",children:u>0?`${u}/5 sao`:"Chưa đánh giá"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"comment",className:"block text-sm font-medium text-gray-700 mb-2",children:"Nhận xét của bạn (tùy chọn)"}),e.jsx("textarea",{id:"comment",rows:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Chia sẻ trải nghiệm của bạn với sản phẩm này...",value:o,onChange:a=>y(a.target.value)})]}),e.jsxs("button",{type:"submit",disabled:l||!h.user,className:`flex items-center justify-center gap-2 px-4 py-2 rounded-md text-white ${l||!h.user?"bg-blue-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"}`,children:[e.jsx(oe,{className:"w-4 h-4"}),l?"Đang gửi...":c?"Cập nhật đánh giá":"Gửi đánh giá"]}),!h.user&&e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Vui lòng đăng nhập để đánh giá sản phẩm"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium border-b pb-2",children:I.length>0?`${I.length} đánh giá từ khách hàng`:"Chưa có đánh giá nào"}),I.map(a=>e.jsxs("div",{className:"border-b pb-4",children:[e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsx("div",{className:"font-medium",children:a.full_name||"Người dùng"}),e.jsx("div",{className:"text-sm text-gray-500",children:i(a.created_at)})]}),e.jsxs("div",{className:"flex items-center mb-2",children:[S(a.rating,!1,`review-${a.review_id}`),a.variant&&e.jsxs("span",{className:"ml-2 text-xs bg-gray-100 text-gray-700 px-2 py-1 rounded",children:[a.variant_color," / ",a.variant_size]})]}),a.comment&&e.jsx("p",{className:"text-gray-700",children:a.comment})]},a.review_id)),I.length>5&&e.jsx("div",{className:"text-center pt-2",children:e.jsx("button",{className:"text-blue-600 hover:text-blue-800 text-sm font-medium",children:"Xem tất cả đánh giá"})})]})]})},me=({product:s,isOpen:g,onClose:h,isInWishlist:u=!1})=>{var F,H,O;const{auth:N}=U().props,[f,b]=r.useState(0),[o,y]=r.useState(null),[l,p]=r.useState(null),[x,m]=r.useState(1),[C,w]=r.useState(!1),[c,d]=r.useState(null),{addToCart:I}=ee(),[W,j]=r.useState(u),{addToWishlist:M,removeItem:A}=G(),E=async()=>{if(!N.user){d("Please log in to manage your wishlist");return}try{if(W)await A(s.product_id),j(!1);else{const t=await M(s.product_id);t.success?j(!0):d(t.message)}}catch{d("An error occurred while updating your wishlist")}};r.useEffect(()=>{g&&(y(null),p(null),d(null),m(1),b(0))},[g,s]);const $=r.useMemo(()=>{const t=new Map;return s!=null&&s.variants&&s.variants.forEach(n=>{t.has(n.size_id)||t.set(n.size_id,new Map),t.get(n.size_id).set(n.color_id,n)}),t},[s==null?void 0:s.variants]),S=(t,n)=>{const z=$.get(t);if(!z)return!1;const q=z.get(n);return q&&q.stock_quantity>0},i=r.useMemo(()=>{if(!l||!o)return null;const t=$.get(l.size_id);return t?t.get(o.color_id):null},[l,o,$]),_=r.useMemo(()=>i&&i.image_url?[{image_id:`variant-${i.variant_id}`,image_url:i.image_url},...s.images]:s.images,[i,s.images]);r.useEffect(()=>{i&&i.image_url&&b(0)},[i]);const a=t=>{t.preventDefault(),t.stopPropagation(),b(n=>(n+1)%_.length)},v=t=>{t.preventDefault(),t.stopPropagation(),b(n=>(n-1+_.length)%_.length)},P=t=>{t.preventDefault(),t.stopPropagation(),i&&x<i.stock_quantity&&m(n=>n+1)},R=t=>{t.preventDefault(),t.stopPropagation(),x>1&&m(n=>n-1)},D=t=>{const n=parseInt(t.target.value);!isNaN(n)&&n>=1&&(i&&n<=i.stock_quantity?m(n):i&&m(i.stock_quantity))},k=async()=>{if(!N.user){d("Vui lòng đăng nhập để mua hàng!");return}if(!i){d("Please select both size and color before adding to cart.");return}try{w(!0),d(null);const t=await I(i.variant_id,x);t.success?h():d(t.message||"Failed to add item to cart. Please try again.")}catch{d("An error occurred while adding to cart. Please try again.")}finally{w(!1)}};return s?e.jsx(se,{open:g,onOpenChange:h,children:e.jsxs(te,{className:"max-w-full sm:max-w-4xl p-0 w-full sm:h-auto max-h-screen flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"sticky top-0 z-20 bg-white p-4 flex items-center justify-between border-b",children:[e.jsx("h2",{className:"text-lg font-bold truncate",children:s.name}),e.jsx("button",{onClick:h,className:"p-1",children:e.jsx(ie,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"p-4 sm:p-6",children:[c&&e.jsx(L,{variant:"destructive",className:"mb-4",children:e.jsx(V,{children:c})}),e.jsxs("div",{className:"flex flex-col sm:grid sm:grid-cols-2 gap-6 sm:gap-8",children:[e.jsxs("div",{className:"relative space-y-4",children:[e.jsxs("div",{className:"relative overflow-hidden rounded-lg shadow-sm",style:{aspectRatio:"3/4"},children:[e.jsx("img",{src:(F=_[f])==null?void 0:F.image_url,alt:`${s.name} ${i?`- ${o.name} ${l.name}`:""}`,className:"w-full h-full object-cover transition-transform duration-300 hover:scale-105"}),_.length>1&&e.jsxs("div",{className:"absolute inset-0 flex items-center justify-between p-2",children:[e.jsx("button",{onClick:v,className:"bg-black/40 p-2 rounded-full text-white hover:bg-black/60 transition-colors",children:e.jsx(K,{className:"w-4 h-4 sm:w-5 sm:h-5"})}),e.jsx("button",{onClick:a,className:"bg-black/40 p-2 rounded-full text-white hover:bg-black/60 transition-colors",children:e.jsx(X,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]})]}),e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 snap-x space-x-2",children:_.map((t,n)=>e.jsx("button",{onClick:()=>b(n),className:`flex-shrink-0 w-16 sm:w-20 h-20 sm:h-24 rounded-lg overflow-hidden snap-start border transition-all duration-300
                                                ${f===n?"ring-2 ring-blue-500 border-blue-300":"hover:border-blue-200 opacity-80 hover:opacity-100"}`,children:e.jsx("img",{src:t.image_url,alt:`${s.name} thumbnail ${n===0&&(i!=null&&i.image_url)?`(${o==null?void 0:o.name})`:`${n+1}`}`,className:"w-full h-full object-cover"})},t.image_id))})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900 leading-tight",children:s.name}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Z,{price:(i==null?void 0:i.price)||s.price,salePrice:(i==null?void 0:i.sale_price)||s.sale_price}),s.sku&&e.jsxs("div",{className:"text-sm text-gray-500",children:["SKU: ",s.sku]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(re,{className:"w-5 h-5 text-blue-500"}),e.jsx("h3",{className:"text-base font-semibold text-gray-800",children:"Thông tin chi tiết sản phẩm"})]}),e.jsx("p",{className:"text-base text-gray-700 leading-relaxed",children:s.description})]}),s.material&&e.jsxs("div",{className:"border-l-4 border-blue-500 pl-4 py-2 bg-blue-50/50",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900 mb-1",children:"Chất liệu sản phẩm"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-base text-gray-800",children:s.material.name}),s.material.description&&e.jsx("p",{className:"text-sm text-gray-600",children:s.material.description})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Chọn kích cỡ"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:(H=s.available_sizes)==null?void 0:H.map(t=>e.jsx("button",{onClick:()=>{p(t),o&&!S(t.size_id,o.color_id)&&y(null)},className:`px-4 py-2 text-base border rounded-md transition-all
                                                    ${(l==null?void 0:l.size_id)===t.size_id?"border-blue-500 bg-blue-50 text-blue-700":"hover:border-blue-300 hover:bg-gray-50"}`,children:t.name},t.size_id))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Chọn màu"}),e.jsx("div",{className:"flex flex-wrap gap-3",children:(O=s.available_colors)==null?void 0:O.map(t=>{var z;const n=l?S(l.size_id,t.color_id):(z=s.variants)==null?void 0:z.some(q=>q.color_id===t.color_id&&q.stock_quantity>0);return e.jsx("button",{onClick:()=>{n&&y(t)},disabled:!n,className:`p-1 rounded-full transition-all duration-300
                                                        ${(o==null?void 0:o.color_id)===t.color_id?"ring-2 ring-blue-500 scale-110":""} ${n?"hover:scale-110":"opacity-40 cursor-not-allowed"}`,title:`${t.name}${l&&S(l.size_id,t.color_id)?` - ${$.get(l.size_id).get(t.color_id).stock_quantity} in stock`:n?"":" - Đã hết sản phẩm"}`,children:e.jsx("div",{className:"w-8 h-8 rounded-full border border-gray-200 shadow-sm",style:{backgroundColor:t.description}})},t.color_id)})})]}),i&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Chọn số lượng"}),e.jsxs("p",{className:"text-sm text-green-600",children:["Hiện còn ",i.stock_quantity," sản phẩm"]})]}),e.jsx("div",{className:"flex items-center space-x-4",children:e.jsxs("div",{className:"flex items-center border rounded-lg overflow-hidden",children:[e.jsx("button",{type:"button",onClick:R,disabled:x<=1,className:"p-2 hover:bg-gray-100 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(le,{className:"w-5 h-5"})}),e.jsx("input",{type:"number",min:"1",max:i.stock_quantity,value:x,onChange:D,className:"w-16 text-center border-x p-2 text-base focus:outline-none focus:ring-1 focus:ring-blue-300"}),e.jsx("button",{type:"button",onClick:P,disabled:x>=i.stock_quantity,className:"p-2 hover:bg-gray-100 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(ne,{className:"w-5 h-5"})})]})})]})]})]}),e.jsx(de,{productId:s.product_id,variant:i})]})}),e.jsx("div",{className:"sticky bottom-0 left-0 right-0 bg-white border-t border-gray-100 py-4 px-4 z-10 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)]",children:e.jsxs("div",{className:"flex gap-3 sm:gap-4 max-w-4xl mx-auto",children:[e.jsxs("button",{type:"button",className:`flex-1 text-white py-2 px-3 sm:px-4 rounded-lg flex items-center justify-center gap-2 transition-all duration-300
                                ${!i||i.stock_quantity<=0||C?"bg-blue-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 active:scale-95"}`,disabled:!i||i.stock_quantity<=0||C,onClick:k,children:[e.jsx(Y,{className:"w-5 h-5"}),C?"Đang thêm vào giỏ hàng...":i?i.stock_quantity<=0?"Hết hàng":"Thêm vào giỏ hàng":"Chọn sản phẩm"]}),e.jsx("button",{type:"button",onClick:E,className:"p-3 rounded-lg border hover:bg-gray-50 transition-colors group",children:e.jsx(J,{className:`w-5 h-5 transition-all duration-300
                                    ${W?"fill-red-500 text-red-500 scale-110 group-hover:scale-125":"text-gray-600 group-hover:text-red-400"}`})})]})})]})}):null},he=({product:s,isInWishlist:g=!1})=>{var w;const[h,u]=r.useState(0),[N,f]=r.useState(!1),[b,o]=r.useState(g),{addToWishlist:y,removeItem:l}=G(),p=async c=>{c.preventDefault(),c.stopPropagation();try{b?(await l(s.product_id),o(!1)):(await y(s.product_id)).success&&o(!0)}catch(d){console.error("Error toggling wishlist:",d)}},x=c=>{c.preventDefault(),c.stopPropagation(),u(d=>d===0?s.images.length-1:d-1)},m=c=>{c.preventDefault(),c.stopPropagation(),u(d=>d===s.images.length-1?0:d+1)},C=c=>{c.preventDefault(),c.stopPropagation(),f(!0)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden hover:shadow-lg transition-shadow group relative cursor-pointer",onClick:()=>f(!0),children:[e.jsx("div",{className:"relative w-full pt-[133%]",children:e.jsxs("div",{className:"absolute inset-0",children:[e.jsx("img",{src:((w=s.images[h])==null?void 0:w.image_url)||"/path/to/fallback.jpg",alt:s.name,className:"w-full h-full object-cover"}),s.images.length>1&&e.jsxs("div",{className:"absolute inset-y-0 w-full flex items-center justify-between px-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:x,className:"bg-black/50 p-1 rounded-full text-white hover:bg-black/70 transition-colors",children:e.jsx(K,{className:"w-6 h-6"})}),e.jsx("button",{onClick:m,className:"bg-black/50 p-1 rounded-full text-white hover:bg-black/70 transition-colors",children:e.jsx(X,{className:"w-6 h-6"})})]}),e.jsx("button",{onClick:p,className:"absolute top-2 right-2 p-2 rounded-full bg-white/80 hover:bg-white transition-colors",children:e.jsx(J,{className:`w-5 h-5 ${b?"fill-red-500 text-red-500":"text-gray-600"}`})})]})}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-black/40 backdrop-blur-sm p-4 text-white",children:[e.jsxs("div",{className:"flex justify-between items-start gap-4",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h3",{className:"text-lg font-medium truncate max-w-full sm:text-base md:text-lg lg:text-xl",children:s.name}),e.jsx(Z,{price:s.price,salePrice:s.sale_price})]}),e.jsx("button",{onClick:C,className:"flex-shrink-0 bg-white/20 hover:bg-white/30 p-2 rounded-full transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:s.stock_quantity<=0,children:e.jsx(Y,{className:"w-6 h-6 text-white"})})]}),s.stock_quantity<=0&&e.jsx(ce,{})]})]}),e.jsx(me,{product:s,isOpen:N,onClose:()=>f(!1),onToggleWishlist:p,isInWishlist:b})]})},we=({products:s=[],currentImageIndexes:g={},onPrevImage:h,onNextImage:u,onToggleWishlist:N,wishlist:f=[]})=>{const b=(l,p)=>{const x={...p};return l.forEach(m=>{m!=null&&m.product_id&&!(m.product_id in x)&&(x[m.product_id]=0)}),x},o=l=>Array.isArray(f)?typeof f[0]=="number"||typeof f[0]=="string"?f.includes(l):f.some(p=>p.product_id===l||p.id===l||p===l):!1,y=b(s,g);return e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",children:s.filter(l=>l&&l.product_id).map(l=>e.jsx(he,{product:l,currentImageIndex:y[l.product_id],onPrevImage:()=>h(l.product_id),onNextImage:()=>u(l.product_id),onToggleWishlist:()=>N(l.product_id),isInWishlist:o(l.product_id)},l.product_id))})};export{we as P};
