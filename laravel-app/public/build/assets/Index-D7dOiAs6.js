import{r as a,j as e,L as ae,a as k}from"./app-DM5lWH7w.js";import{A as re,B as ie}from"./Breadcrumb-DriWI8JK.js";import{B as c}from"./button-D_azY7HU.js";import{I as _}from"./input-C9qzQYtQ.js";import{T as ne,a as le,b as v,c as N,d as ce,e as i}from"./table-BGT-YAZs.js";import{S as F,a as I,b as H,c as E,d as m}from"./select-lTbdTkTd.js";import oe from"./InventoryCheckForm-DY8tp7yA.js";import{C as B}from"./calendar-D95ocz5F.js";import{E as de}from"./eye-CSKhNZ0e.js";import{S as me}from"./square-pen-BCmOeaAW.js";import{T as he}from"./trash-2-Dy2jXSrq.js";import{A as xe}from"./arrow-up-down-BlfunGSh.js";import{f as pe}from"./format-D9VrrLpI.js";import"./shopping-cart-CZJG6TeG.js";import"./index-H22tECQ6.js";import"./utils-De8wPBUk.js";import"./star-NL1IKTr_.js";import"./truck-PZjfZowP.js";import"./shopping-bag-D-8jhm6x.js";import"./users-Bg5QJiIM.js";import"./search-DZ4Pfh-R.js";import"./user-DrHZ__g_.js";import"./index-ijvaBZ7a.js";import"./index-v8iwHGUi.js";import"./index-BeqeRdpr.js";import"./index-o3Sz-yc3.js";import"./check-Ct5f1nwX.js";import"./dialog-_yQDYPAD.js";import"./index-B4EdUvDt.js";import"./x-ToVJaZZw.js";import"./label-Dh85IkX1.js";import"./textarea-V4QGxS2H.js";import"./plus-DECCMGFS.js";function Je(){const[o,C]=a.useState([]),[$,T]=a.useState(!0),[d,z]=a.useState(""),[h,A]=a.useState("all"),[x,K]=a.useState("all"),[P,M]=a.useState([]),[p,V]=a.useState(""),[u,R]=a.useState(""),[q,g]=a.useState(!1),[Q,f]=a.useState(null),[n,L]=a.useState({current_page:1,per_page:10,total:0,last_page:1}),[w,U]=a.useState("check_date"),[b,D]=a.useState("desc"),G={draft:"Nháp",completed:"Hoàn thành"},J={draft:"bg-gray-100 text-gray-800",completed:"bg-green-100 text-green-800"},O=async()=>{try{const t=await k.get("/admin/users");t.data&&t.data.data&&M(t.data.data)}catch(t){console.error("Lỗi khi tải danh sách người tạo:",t)}},j=async()=>{try{T(!0);const t={};d&&d.trim()!==""&&(t.search=d.trim()),h!=="all"&&(t.status=h),x!=="all"&&(t.create_by=x),p&&(t.from_date=p),u&&(t.to_date=u),t.page=n.current_page,t.per_page=n.per_page,t.sort_field=w,t.sort_direction=b;const s=await k.get("/api/v1/inventory-checks",{params:t});s.data&&s.data.data&&(C(s.data.data.data),L({current_page:s.data.data.current_page,per_page:s.data.data.per_page,total:s.data.data.total,last_page:s.data.data.last_page})),console.log("Danh sách kiểm kê kho:",o)}catch(t){console.error("Lỗi khi tải kiểm kê kho:",t),C([])}finally{T(!1)}};a.useEffect(()=>{O()},[]),a.useEffect(()=>{const t=setTimeout(()=>{j()},300);return()=>clearTimeout(t)},[d,h,x,p,u,n.current_page,w,b]);const W=t=>{w===t?D(b==="asc"?"desc":"asc"):(U(t),D("asc"))},X=async t=>{var s,r;if(confirm("Bạn có chắc chắn muốn xóa phiếu kiểm kê này không?"))try{(await k.delete(`/admin/inventory-checks/${t}`)).data.status==="success"&&(j(),alert("Phiếu kiểm kê đã được xóa thành công"))}catch(l){console.error("Lỗi khi xóa phiếu kiểm kê:",l),alert(((r=(s=l.response)==null?void 0:s.data)==null?void 0:r.message)||`Lỗi khi xóa phiếu kiểm kê ${t}`)}},Y=async(t,s)=>{var r,l;try{(await k.put(`/admin/inventory-checks/${t}/status`,{status:s})).data.status==="success"&&(j(),alert("Trạng thái phiếu kiểm kê đã được cập nhật thành công"))}catch(S){console.error("Lỗi khi cập nhật trạng thái phiếu kiểm kê:",S),alert(((l=(r=S.response)==null?void 0:r.data)==null?void 0:l.message)||"Lỗi khi cập nhật trạng thái phiếu kiểm kê")}},Z=[{label:"Kiểm kê kho",href:"/admin/inventory-checks"}],ee=()=>{const t=[];for(let s=1;s<=n.last_page;s++)t.push(e.jsx(c,{variant:n.current_page===s?"default":"outline",className:"w-10 h-10",onClick:()=>L(r=>({...r,current_page:s})),children:s},s));return t},y=({field:t,children:s})=>e.jsx(N,{className:"py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer",onClick:()=>W(t),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:s}),e.jsx(xe,{className:"w-4 h-4"})]})}),te=t=>t?pe(new Date(t),"dd/MM/yyyy"):"",se=t=>!t.details||t.details.length===0?0:t.details.filter(s=>s.difference!==0).length;return e.jsxs(re,{children:[e.jsx(ae,{title:"Quản lý kiểm kê kho"}),e.jsxs("div",{className:"container mx-auto py-6 px-4",children:[e.jsx(ie,{items:Z}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Kiểm kê kho"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 w-full sm:w-auto",children:[e.jsx(_,{type:"text",placeholder:"Tìm kiếm phiếu kiểm kê...",value:d,onChange:t=>z(t.target.value),className:"w-full sm:w-64"}),e.jsx(c,{onClick:()=>{f(null),g(!0)},children:"Thêm phiếu kiểm kê mới"})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden mb-6",children:e.jsxs("div",{className:"p-4 grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("div",{children:e.jsxs(F,{value:h,onValueChange:A,children:[e.jsx(I,{children:e.jsx(H,{placeholder:"Lọc theo trạng thái"})}),e.jsxs(E,{children:[e.jsx(m,{value:"all",children:"Tất cả trạng thái"}),e.jsx(m,{value:"draft",children:"Nháp"}),e.jsx(m,{value:"completed",children:"Hoàn thành"})]})]})}),e.jsx("div",{children:e.jsxs(F,{value:x,onValueChange:K,children:[e.jsx(I,{children:e.jsx(H,{placeholder:"Lọc theo người tạo"})}),e.jsxs(E,{children:[e.jsx(m,{value:"all",children:"Tất cả người tạo"}),P.map(t=>e.jsx(m,{value:t.id,children:t.name},t.id))]})]})}),e.jsx("div",{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(B,{className:"h-4 w-4"}),e.jsx(_,{type:"date",value:p,onChange:t=>V(t.target.value),className:"w-full",placeholder:"Từ ngày"})]})}),e.jsx("div",{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(B,{className:"h-4 w-4"}),e.jsx(_,{type:"date",value:u,onChange:t=>R(t.target.value),className:"w-full",placeholder:"Đến ngày"})]})})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(ne,{children:[e.jsx(le,{children:e.jsxs(v,{className:"bg-gray-50",children:[e.jsx(y,{field:"check_id",children:"Mã phiếu"}),e.jsx(y,{field:"create_by",children:"Người tạo"}),e.jsx(y,{field:"check_date",children:"Ngày kiểm kê"}),e.jsx(N,{className:"py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Số sản phẩm"}),e.jsx(N,{className:"py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Số sp chênh lệch"}),e.jsx(y,{field:"status",children:"Trạng thái"}),e.jsx(N,{className:"py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Hành động"})]})}),e.jsx(ce,{children:$?e.jsx(v,{children:e.jsx(i,{colSpan:7,className:"text-center py-4",children:e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-gray-900"})})})}):!o||o.length===0?e.jsx(v,{children:e.jsx(i,{colSpan:7,className:"text-center py-4 text-gray-500",children:"Không có phiếu kiểm kê nào"})}):o.map(t=>{var s,r;return e.jsxs(v,{className:"hover:bg-gray-50 transition-colors",children:[e.jsxs(i,{className:"py-4 px-6 text-sm text-gray-900 font-medium",children:["#",t.check_id]}),e.jsx(i,{className:"py-4 px-6 text-sm text-gray-900",children:((s=t.created_by_user)==null?void 0:s.name)||"Không xác định"}),e.jsx(i,{className:"py-4 px-6 text-sm text-gray-900",children:te(t.check_date)}),e.jsx(i,{className:"py-4 px-6 text-sm text-gray-900",children:((r=t.details)==null?void 0:r.length)||0}),e.jsx(i,{className:"py-4 px-6 text-sm text-gray-900",children:se(t)}),e.jsx(i,{className:"py-4 px-6 text-sm",children:e.jsx("span",{className:`px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${J[t.status]}`,children:G[t.status]||t.status})}),e.jsx(i,{className:"py-4 px-6 text-sm text-gray-900",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{variant:"outline",size:"sm",className:"text-blue-600 hover:text-blue-700",onClick:()=>window.location.href=`/admin/inventory-checks/${t.check_id}`,children:e.jsx(de,{className:"h-4 w-4"})}),t.status==="draft"&&e.jsxs(e.Fragment,{children:[e.jsx(c,{variant:"outline",size:"sm",className:"text-amber-600 hover:text-amber-700",onClick:()=>{f(t),g(!0)},children:e.jsx(me,{className:"h-4 w-4"})}),e.jsx(c,{variant:"destructive",size:"sm",className:"bg-red-600 hover:bg-red-700 text-white",onClick:()=>X(t.check_id),children:e.jsx(he,{className:"h-4 w-4"})})]}),t.status==="draft"&&e.jsx(c,{size:"sm",className:"bg-green-600 hover:bg-green-700 text-white",onClick:()=>Y(t.check_id,"completed"),children:"Hoàn thành"})]})})]},t.check_id)})})]})}),e.jsxs("div",{className:"flex justify-between items-center p-4 border-t",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Hiển thị ",o.length," trên ",n.total," phiếu kiểm kê"]}),e.jsx("div",{className:"flex gap-2",children:ee()})]})]}),q&&e.jsx(oe,{inventoryCheck:Q,onClose:()=>{g(!1),f(null)},onSuccess:()=>{g(!1),f(null),j()}})]})]})}export{Je as default};
