import{r as i,j as a,a as l}from"./app-DM5lWH7w.js";import{B as E}from"./button-D_azY7HU.js";import{D as A,a as G,b as K,c as X,d as Y}from"./dialog-_yQDYPAD.js";import Z from"./BasicInformationForm-XhX9AK3u.js";import tt from"./PricingInventoryForm-B4Hqvwzi.js";import at from"./DescriptionForm-JJHQXmhP.js";import et from"./TagsManager-CU62H3ef.js";import st from"./VariantsManager-CYWwn-Ff.js";import it from"./ImagesManager-BVlVwD0g.js";import{uploadToCloudinary as rt}from"./Utils-EKZXVTee.js";import"./index-H22tECQ6.js";import"./utils-De8wPBUk.js";import"./index-v8iwHGUi.js";import"./index-ijvaBZ7a.js";import"./index-B4EdUvDt.js";import"./x-ToVJaZZw.js";import"./input-C9qzQYtQ.js";import"./label-Dh85IkX1.js";import"./select-lTbdTkTd.js";import"./index-BeqeRdpr.js";import"./index-o3Sz-yc3.js";import"./check-Ct5f1nwX.js";import"./checkbox-D22MXWb1.js";import"./textarea-V4QGxS2H.js";import"./badge-D2PfSuDc.js";import"./plus-DECCMGFS.js";import"./table-BGT-YAZs.js";import"./card-DjyVTpSh.js";import"./trash-B9vdY9Sb.js";function zt({product:t,onClose:x,onSuccess:F}){const[d,g]=i.useState({category_id:"",material_id:"",brand:"",name:"",description:"",price:"",sale_price:"",stock_quantity:"0",min_purchase_quantity:"1",max_purchase_quantity:"10",gender:"unisex",care_instruction:"",is_active:!0,sku:""}),[S,j]=i.useState([]),[u,v]=i.useState([]),[h,b]=i.useState([]),[N,T]=i.useState([]),[I,R]=i.useState([]),[z,M]=i.useState([]),[P,B]=i.useState([]),[O,H]=i.useState([]),[k,D]=i.useState({}),[q,w]=i.useState(!1),[L,C]=i.useState(!0);i.useEffect(()=>{const r=u.reduce((e,o)=>e+(parseInt(o.stock_quantity)||0),0);g(e=>({...e,stock_quantity:r.toString()}))},[u]),i.useEffect(()=>{(async()=>{var e,o,n,p,s,m;try{C(!0);const[c,J,Q,U,W]=await Promise.all([l.get("/api/v1/categories"),l.get("/api/v1/materials"),l.get("/api/v1/tags"),l.get("/api/v1/sizes"),l.get("/api/v1/colors")]);T(c.data.data),R(J.data.data),M(Q.data.data),B(U.data.data),H(W.data.data),t&&(g({category_id:((e=t.category_id)==null?void 0:e.toString())||"",material_id:((o=t.material_id)==null?void 0:o.toString())||"",brand:t.brand||"",name:t.name||"",description:t.description||"",price:((n=t.price)==null?void 0:n.toString())||"",sale_price:((p=t.sale_price)==null?void 0:p.toString())||"",stock_quantity:"0",min_purchase_quantity:((s=t.min_purchase_quantity)==null?void 0:s.toString())||"1",max_purchase_quantity:((m=t.max_purchase_quantity)==null?void 0:m.toString())||"10",gender:t.gender||"unisex",care_instruction:t.care_instruction||"",is_active:t.is_active||!0,sku:t.sku||""}),t.tags&&j(t.tags.map(f=>f.id)),t.variants&&v(t.variants),t.images&&b(t.images.map((f,$)=>({...f,display_order:f.display_order||$}))))}catch(c){console.error("Error loading form data:",c)}finally{C(!1)}})()},[t]);const y=r=>{const{name:e,value:o}=r.target;g(n=>({...n,[e]:o}))},V=async r=>{console.log("Form data trước khi gửi:",d),r.preventDefault(),w(!0),D({});try{const e={...d,is_active:d.is_active?1:0,tags:S,variants:u.map(s=>({size_id:s.size_id,color_id:s.color_id,price:s.price,stock_quantity:s.stock_quantity,id:s.id&&!s.id.toString().startsWith("temp-")?s.id:void 0}))},o=[],n=[];for(let s=0;s<h.length;s++){const m=h[s];m.file?o.push(rt(m.file).then(c=>{n.push({display_order:s,type:"new",public_id:c.public_id,image_url:c.url,format:c.format,is_primary:s===0})})):m.image_id&&n.push({display_order:s,type:"existing",image_id:m.image_id,is_primary:s===0})}await Promise.all(o),e.images=JSON.stringify(n),console.log("Dữ liệu sản phẩm gửi đi:",e);let p;t?p=await l.post(`/admin/products/${t.product_id}`,e):p=await l.post("/admin/products",e),p.data.success&&F()}catch(e){console.error("Error submitting product form:",e),e.response&&e.response.data&&(console.log("Chi tiết lỗi:",e.response.data),D(e.response.data.errors||{}))}finally{w(!1)}},_=({field:r})=>k[r]?a.jsx("p",{className:"text-sm text-red-500 mt-1",children:k[r][0]}):null;return a.jsx(A,{open:!0,onOpenChange:x,children:a.jsxs(G,{className:"sm:max-w-[80vw] max-h-[90vh] overflow-y-auto",children:[a.jsx(K,{children:a.jsx(X,{children:t?"Chỉnh sửa sản phẩm":"Thêm sản phẩm mới"})}),L?a.jsx("div",{className:"flex justify-center p-6",children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"})}):a.jsxs("form",{onSubmit:V,className:"space-y-6",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsx(Z,{formData:d,handleChange:y,categories:N,materials:I,setFormData:g,ErrorMessage:_}),a.jsx(tt,{formData:d,handleChange:y,ErrorMessage:_,stockQuantityReadOnly:!0})]}),a.jsx(at,{formData:d,handleChange:y,ErrorMessage:_}),a.jsx(et,{selectedTags:S,setSelectedTags:j,tags:z}),a.jsx(st,{variants:u,setVariants:v,sizes:P,colors:O}),a.jsx(it,{images:h,setImages:b,ErrorMessage:_}),a.jsxs(Y,{children:[a.jsx(E,{type:"button",variant:"outline",onClick:x,children:"Hủy"}),a.jsx(E,{type:"submit",disabled:q,children:q?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"mr-2 h-4 w-4 animate-spin rounded-full border-2 border-t-transparent"}),"Đang xử lý..."]}):t?"Cập nhật sản phẩm":"Thêm sản phẩm"})]})]})]})})}export{zt as default};
