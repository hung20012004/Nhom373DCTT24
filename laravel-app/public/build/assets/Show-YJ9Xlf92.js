import{r as d,m as F,j as e,L as P,$,S as x}from"./app-DM5lWH7w.js";import{L as A}from"./Layout-DVh4xpEi.js";import{C as r,a as c,b as i,c as l}from"./card-DjyVTpSh.js";import{B as n}from"./button-D_azY7HU.js";import{B as w}from"./badge-D2PfSuDc.js";import{S as H}from"./separator-D-j3PisJ.js";import{D as V,e as E,a as M,b as X,c as K,f as G,d as R}from"./dialog-_yQDYPAD.js";import{T as q}from"./textarea-V4QGxS2H.js";import{u as z}from"./use-toast-CcV5NpMB.js";import I from"./SupportForm-D-Ag6iBh.js";import{A as Q}from"./arrow-left-D2uTfI0H.js";import{C as Y,M as J}from"./map-pin-CxyWG5si.js";import{C as y}from"./circle-check-big-CYwe5r7P.js";import{S as C}from"./shopping-bag-D-8jhm6x.js";import{C as U}from"./circle-alert-DyacK_RC.js";import{C as W,T as Z,B as ee,P as se}from"./truck-PZjfZowP.js";import{c as ae}from"./index-H22tECQ6.js";import"./index-o3Sz-yc3.js";import"./index-v8iwHGUi.js";import"./trash-2-Dy2jXSrq.js";import"./plus-DECCMGFS.js";import"./alert-cZJMHzEk.js";import"./checkbox-D22MXWb1.js";import"./utils-De8wPBUk.js";import"./index-B4EdUvDt.js";import"./index-ijvaBZ7a.js";import"./check-Ct5f1nwX.js";import"./shopping-cart-CZJG6TeG.js";import"./search-DZ4Pfh-R.js";import"./user-DrHZ__g_.js";import"./x-ToVJaZZw.js";import"./mail-CpnXhq4x.js";import"./label-Dh85IkX1.js";import"./select-lTbdTkTd.js";import"./index-BeqeRdpr.js";/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=ae("PackageCheck",[["path",{d:"m16 16 2 2 4-4",key:"gfu2re"}],["path",{d:"M21 10V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l2-1.14",key:"e7tb2h"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["line",{x1:"12",x2:"12",y1:"22",y2:"12",key:"a4e8g8"}]]),t=s=>s==null||isNaN(s)?"0 ₫":new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(s),Me=({order:s})=>{const[_,p]=d.useState(!1),[g,h]=d.useState(!1),[k,j]=d.useState(!1),{toast:o}=z(),u=F({reason:""}),f=a=>{switch(a){case"new":return{label:"Mới tạo",color:"bg-blue-500"};case"confirmed":return{label:"Đã xác nhận",color:"bg-green-700"};case"processing":return{label:"Đang xử lý",color:"bg-orange-500"};case"preparing":return{label:"Đang chuẩn bị hàng",color:"bg-yellow-500"};case"packed":return{label:"Đã đóng gói",color:"bg-purple-500"};case"shipping":return{label:"Đang giao hàng",color:"bg-indigo-500"};case"delivered":return{label:"Đã giao hàng",color:"bg-green-500"};case"completed":return{label:"Đã nhận hàng",color:"bg-green-600"};case"cancelled":return{label:"Đã hủy",color:"bg-red-500"};default:return{label:"Khác",color:"bg-gray-500"}}},b=a=>{switch(a){case"paid":return{label:"Đã thanh toán",color:"bg-green-500"};case"pending":return{label:"Chờ thanh toán",color:"bg-yellow-500"};case"awaiting_payment":return{label:"Chờ thanh toán",color:"bg-yellow-500"};default:return{label:"Chưa thanh toán",color:"bg-red-500"}}},v=a=>new Date(a).toLocaleDateString("vi-VN",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),[te,m]=d.useState(!1),S=()=>{m(!0),x.post(`/order/${s.order_id}/confirm-received`,{},{onSuccess:()=>{m(!1),o({title:"Thành công",description:"Xác nhận đã nhận hàng thành công."}),x.reload()},onError:a=>{m(!1),o({title:"Lỗi",description:a.error||"Đã xảy ra lỗi khi xác nhận",variant:"destructive"})},onFinish:()=>{m(!1)}})},D=a=>{switch(a){case"new":return e.jsx(C,{className:"h-6 w-6"});case"confirmed":return e.jsx(y,{className:"h-6 w-6"});case"processing":return e.jsx(se,{className:"h-6 w-6"});case"preparing":return e.jsx(ee,{className:"h-6 w-6"});case"packed":return e.jsx(ne,{className:"h-6 w-6"});case"shipping":return e.jsx(Z,{className:"h-6 w-6"});case"delivered":return e.jsx(W,{className:"h-6 w-6"});case"completed":return e.jsx(y,{className:"h-6 w-6"});case"cancelled":return e.jsx(U,{className:"h-6 w-6"});default:return e.jsx(C,{className:"h-6 w-6"})}},T=()=>{h(!0),x.post(`/order/${s.order_id}/cancel`,{reason:u.data.reason},{onSuccess:()=>{h(!1),p(!1),o({title:"Thành công",description:"Đơn hàng đã được hủy thành công."}),x.reload()},onError:a=>{h(!1),o({title:"Lỗi",description:a.error||"Đã xảy ra lỗi khi hủy đơn hàng",variant:"destructive"})},onFinish:()=>{h(!1)}})},L=()=>!s.history||s.history.length===0?e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-gray-500",children:"Chưa có lịch sử trạng thái đơn hàng."})}):e.jsx("div",{className:"space-y-4",children:s.history.map((a,N)=>e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0 mr-4",children:e.jsx("div",{className:"bg-gray-100 rounded-full p-2",children:D(a.status)})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:f(a.status).label}),e.jsx("p",{className:"text-sm text-gray-600",children:a.comment}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:v(a.created_at)})]})]},N))}),B=["new","processing","preparing","packed"].includes(s.order_status);return e.jsxs(A,{children:[e.jsx(P,{title:`Chi tiết đơn hàng #${s.order_id}`}),e.jsxs("div",{className:"max-w-6xl mx-auto py-6 px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx(n,{asChild:!0,variant:"ghost",className:"p-0 mb-2",children:e.jsxs($,{href:"/order",children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Quay lại danh sách đơn hàng"]})}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between",children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center",children:["Chi tiết đơn hàng #",s.order_id,e.jsx(w,{className:`ml-3 ${f(s.order_status).color} text-white`,children:f(s.order_status).label})]}),e.jsxs("p",{className:"text-gray-600 mt-1 md:mt-0",children:["Ngày đặt: ",v(s.order_date)]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(r,{children:[e.jsx(c,{children:e.jsx(i,{className:"text-xl",children:"Sản phẩm đã đặt"})}),e.jsx(l,{children:e.jsx("div",{className:"space-y-4",children:s.details&&s.details.length>0?s.details.map(a=>e.jsxs("div",{className:"flex items-center space-x-4 py-3 border-b last:border-0",children:[e.jsx("img",{src:a.variant&&a.variant.image_url?a.variant.image_url:"/placeholder.png",alt:a.variant?a.variant.name:"Sản phẩm",className:"w-20 h-24 object-cover rounded"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium",children:a.variant?a.variant.product.name:"Sản phẩm"}),e.jsxs("p",{className:"text-xs text-gray-500 mb-2",children:[a.variant.color.name," ","-"," ",a.variant.size.name]}),a.variant&&a.variant.attributes&&e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:Object.entries(a.variant.attributes).map(([N,O])=>`${N}: ${O}`).join(", ")}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("p",{className:"text-gray-600",children:[t(a.unit_price)," ","x ",a.quantity]}),e.jsxs("p",{className:"font-medium",children:[" ",t(a.subtotal)]})]})]})]},a.order_detail_id)):e.jsx("p",{className:"text-gray-500 text-center py-3",children:"Không có thông tin sản phẩm."})})})]}),e.jsxs(r,{children:[e.jsx(c,{children:e.jsx(i,{className:"text-xl",children:"Lịch sử đơn hàng"})}),e.jsx(l,{children:L()})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(r,{children:[e.jsx(c,{children:e.jsx(i,{className:"text-xl",children:"Tóm tắt đơn hàng"})}),e.jsx(l,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Tạm tính:"}),e.jsxs("span",{children:[" ",t(s.subtotal)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Phí vận chuyển:"}),e.jsxs("span",{children:[" ",t(s.shipping_fee)]})]}),s.discount_amount>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Giảm giá:"}),e.jsxs("span",{children:["-"," ",t(s.discount_amount)]})]}),e.jsx(H,{}),e.jsxs("div",{className:"flex justify-between font-medium",children:[e.jsx("span",{children:"Tổng cộng:"}),e.jsxs("span",{className:"text-lg",children:[" ",t(s.total_amount)]})]}),e.jsxs("div",{className:"mt-3 pt-3 border-t",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium",children:"Trạng thái thanh toán:"}),e.jsx(w,{className:b(s.payment_status).color+" text-white",children:b(s.payment_status).label})]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-2 flex items-center",children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),s.payment_method==="cod"?"Thanh toán khi nhận hàng (COD)":"VNPAY"]})]})]})})]}),e.jsxs(r,{children:[e.jsx(c,{children:e.jsx(i,{className:"text-xl",children:"Thông tin giao hàng"})}),e.jsx(l,{children:s.shipping_address?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"font-medium",children:s.shipping_address.recipient_name}),e.jsx("p",{className:"text-gray-600",children:s.shipping_address.phone}),e.jsxs("p",{className:"text-gray-600 flex items-start",children:[e.jsx(J,{className:"h-4 w-4 mr-2 mt-1 flex-shrink-0"}),e.jsxs("span",{children:[s.shipping_address.address,", ",s.shipping_address.ward,","," ",s.shipping_address.district,","," ",s.shipping_address.province]})]})]}):e.jsx("p",{className:"text-gray-500 text-center py-3",children:"Không có thông tin giao hàng."})})]}),s.note&&e.jsxs(r,{children:[e.jsx(c,{children:e.jsx(i,{className:"text-xl",children:"Ghi chú"})}),e.jsx(l,{children:e.jsx("p",{className:"text-gray-600",children:s.note})})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(n,{onClick:()=>{j(!0)},children:"Liên hệ hỗ trợ"}),s.order_status==="delivered"&&e.jsxs(n,{variant:"primary",className:"flex-1 bg-green-600 hover:bg-green-700",onClick:()=>S(),children:[e.jsx(y,{className:"h-4 w-4 mr-2"}),"Xác nhận đã nhận hàng"]}),B&&e.jsxs(V,{open:_,onOpenChange:p,children:[e.jsx(E,{asChild:!0,children:e.jsx(n,{variant:"destructive",className:"flex-1",children:"Hủy đơn hàng"})}),e.jsxs(M,{className:"sm:max-w-md",children:[e.jsxs(X,{children:[e.jsx(K,{children:"Xác nhận hủy đơn hàng"}),e.jsxs(G,{children:["Bạn có chắc chắn muốn hủy đơn hàng #",s.order_id,"? Hành động này không thể hoàn tác."]})]}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"Lý do hủy đơn hàng (tùy chọn):"}),e.jsx(q,{placeholder:"Nhập lý do hủy đơn hàng...",value:u.data.reason,onChange:a=>u.setData("reason",a.target.value),className:"w-full",rows:3})]})}),e.jsxs(R,{children:[e.jsx(n,{variant:"outline",onClick:()=>p(!1),disabled:g,children:"Đóng"}),e.jsx(n,{variant:"destructive",onClick:T,disabled:g,children:g?"Đang hủy...":"Xác nhận hủy"})]})]})]})]})]})]}),k&&e.jsx(I,{orderId:s.order_id,onClose:()=>{j(!1)},onSuccess:()=>{j(!1),fetchCategories()}})]})]})};export{Me as default};
