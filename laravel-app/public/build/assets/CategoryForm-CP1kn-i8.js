import{r as c,j as e,a as g}from"./app-DM5lWH7w.js";import{D as R,a as O,b as T,c as A}from"./dialog-_yQDYPAD.js";import{B as D}from"./button-D_azY7HU.js";import{I as f}from"./input-C9qzQYtQ.js";import{L as m}from"./label-Dh85IkX1.js";import{T as I}from"./textarea-V4QGxS2H.js";import{A as k,a as P}from"./alert-cZJMHzEk.js";import{S as H}from"./switch-DrArOmrB.js";import"./index-v8iwHGUi.js";import"./utils-De8wPBUk.js";import"./index-ijvaBZ7a.js";import"./index-B4EdUvDt.js";import"./x-ToVJaZZw.js";import"./index-H22tECQ6.js";const q="category_images",B="deczn9jtq";function te({category:t,onClose:j,onSuccess:L}){const[l,d]=c.useState({name:"",slug:"",description:"",is_active:!0,display_order:0,image_url:""}),[u,v]=c.useState(!1),[n,_]=c.useState({}),[b,w]=c.useState(""),[o,x]=c.useState(null),[C,N]=c.useState(null);c.useEffect(()=>{t&&(d({name:t.name||"",slug:t.slug||"",description:t.description||"",is_active:t.is_active===1,display_order:t.display_order||0,image_url:t.image_url||""}),x(t.image_url||null))},[t]);const S=s=>{const a=s.target.files[0];if(!a)return;const i=URL.createObjectURL(a);x(i),N(a)},U=async s=>{const a=new FormData;a.append("file",s),a.append("upload_preset",q);try{return(await g.post(`https://api.cloudinary.com/v1_1/${B}/image/upload`,a,{headers:{"Content-Type":"multipart/form-data"},withCredentials:!1})).data.secure_url}catch(i){throw console.error("Lỗi tải ảnh lên Cloudinary:",i),new Error("Không thể tải ảnh lên")}},E=async s=>{var a,i;s.preventDefault(),v(!0),_({}),w("");try{let r={...l};if(C){const p=await U(C);r.image_url=p}else o?t&&(r.image_url=t.image_url):r.image_url="";if(t){const p={};Object.keys(r).forEach(h=>{r[h]!==t[h]&&(p[h]=r[h])}),await g.post(`/admin/categories/${t.id}`,p)}else await g.post("/admin/categories",r);o&&o.startsWith("blob:")&&URL.revokeObjectURL(o),L()}catch(r){(i=(a=r.response)==null?void 0:a.data)!=null&&i.errors?_(r.response.data.errors):w("Đã xảy ra lỗi khi lưu loại sản phẩm. Vui lòng thử lại."),console.error("Lỗi gửi loại sản phẩm:",r)}finally{v(!1)}},F=s=>s.toLowerCase().replace(/[^\w\s-]/g,"").replace(/\s+/g,"-").replace(/--+/g,"-").trim(),y=s=>{const a=s.target.value;d(i=>({...i,name:a,slug:F(a)}))};return e.jsx(R,{open:!0,onOpenChange:j,children:e.jsxs(O,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(T,{children:e.jsx(A,{children:t?"Chỉnh sửa loại sản phẩm":"Thêm loại sản phẩm mới"})}),b&&e.jsx(k,{variant:"destructive",children:e.jsx(P,{children:b})}),e.jsxs("form",{onSubmit:E,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Hình ảnh"}),e.jsxs("div",{className:"flex items-center gap-4",children:[o&&e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:o,alt:"Preview",className:"w-24 h-24 object-cover rounded-lg"}),e.jsx("button",{type:"button",onClick:()=>{o.startsWith("blob:")&&URL.revokeObjectURL(o),x(null),N(null),d(s=>({...s,image_url:""}))},className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center",children:"×"})]}),e.jsx(f,{type:"file",accept:"image/*",onChange:S,disabled:u})]}),n.image_url&&e.jsx("span",{className:"text-red-500 text-sm",children:n.image_url})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"name",children:"Tên"}),e.jsx(f,{id:"name",value:l.name,onChange:y,required:!0}),n.name&&e.jsx("span",{className:"text-red-500 text-sm",children:n.name})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"slug",children:"Slug"}),e.jsx(f,{id:"slug",value:l.slug,onChange:s=>d({...l,slug:s.target.value}),required:!0}),n.slug&&e.jsx("span",{className:"text-red-500 text-sm",children:n.slug})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"description",children:"Mô tả"}),e.jsx(I,{id:"description",value:l.description,onChange:s=>d({...l,description:s.target.value}),rows:4}),n.description&&e.jsx("span",{className:"text-red-500 text-sm",children:n.description})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(H,{id:"is_active",checked:l.is_active,onCheckedChange:s=>d({...l,is_active:s})}),e.jsx(m,{htmlFor:"is_active",children:"Hoạt động"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(D,{type:"button",variant:"outline",onClick:j,disabled:u,children:"Hủy"}),e.jsx(D,{type:"submit",disabled:u,className:"min-w-[100px]",children:u?"Đang lưu...":t?"Cập nhật":"Tạo"})]})]})]})})}export{te as default};
