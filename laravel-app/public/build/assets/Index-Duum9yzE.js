import{r as d,j as a,L as V,a as k}from"./app-DM5lWH7w.js";import{A as W,B as X}from"./Breadcrumb-DriWI8JK.js";import{B as L}from"./button-D_azY7HU.js";import{I as N}from"./input-C9qzQYtQ.js";import{C as Y,a as Z,b as ee,c as ae}from"./card-DjyVTpSh.js";import{B as b}from"./badge-D2PfSuDc.js";import"./select-lTbdTkTd.js";import{D as te,C as T,L as K,P as re}from"./react-beautiful-dnd.esm-CceVe5Va.js";import se from"./OrderDialog-D4wcxNZs.js";import{S as ne}from"./search-DZ4Pfh-R.js";import{C as P}from"./calendar-D95ocz5F.js";import{E as ie}from"./eye-CSKhNZ0e.js";import{f as le}from"./format-D9VrrLpI.js";import"./shopping-cart-CZJG6TeG.js";import"./index-H22tECQ6.js";import"./utils-De8wPBUk.js";import"./star-NL1IKTr_.js";import"./truck-PZjfZowP.js";import"./shopping-bag-D-8jhm6x.js";import"./users-Bg5QJiIM.js";import"./user-DrHZ__g_.js";import"./index-ijvaBZ7a.js";import"./index-v8iwHGUi.js";import"./index-BeqeRdpr.js";import"./index-o3Sz-yc3.js";import"./check-Ct5f1nwX.js";import"./tiny-invariant-BaFNuDhB.js";import"./dialog-_yQDYPAD.js";import"./index-B4EdUvDt.js";import"./x-ToVJaZZw.js";import"./table-BGT-YAZs.js";import"./printer-Br_SKlEC.js";import"./vi-DmPgEhae.js";function Me(){const[y,x]=d.useState([]),[v,w]=d.useState(!0),[g,B]=d.useState(""),[u,E]=d.useState(""),[f,$]=d.useState(""),[R,_]=d.useState(!1),[A,H]=d.useState(null),[c,C]=d.useState({current_page:1,per_page:30,total:0,last_page:1}),j={confirmed:"Đã xác nhận",preparing:"Đang chuẩn bị hàng",packed:"Đã đóng gói"},m={},I={...j,...m},D={new:"bg-blue-100 text-blue-800",confirmed:"bg-cyan-100 text-cyan-800",processing:"bg-green-100 text-green-800",cancelled:"bg-red-100 text-red-800",preparing:"bg-yellow-100 text-yellow-800",packed:"bg-purple-100 text-purple-800",shipping:"bg-indigo-100 text-indigo-800",delivered:"bg-emerald-100 text-emerald-800",shipping_failed:"bg-rose-100 text-rose-800"},M={pending:"Chờ thanh toán",paid:"Đã thanh toán",refunded:"Đã hoàn tiền",failed:"Thanh toán thất bại",awaiting_payment:"Đang chờ thanh toán"},q={pending:"bg-yellow-100 text-yellow-800",paid:"bg-green-100 text-green-800",refunded:"bg-purple-100 text-purple-800",failed:"bg-red-100 text-red-800"},z=e=>{H(e),_(!0)},S=async()=>{try{w(!0);const e={};g&&g.trim()!==""&&(e.search=g.trim()),u&&(e.from_date=u),f&&(e.to_date=f),e.page=c.current_page,e.per_page=c.per_page,e.order_status=Object.keys(I).join(",");const t=await k.get("/api/v1/orders",{params:e});t.data&&t.data.data&&(x(t.data.data.data),C({current_page:t.data.data.current_page,per_page:t.data.data.per_page,total:t.data.data.total,last_page:t.data.data.last_page}))}catch(e){console.error("Lỗi khi tải đơn hàng:",e),x([])}finally{w(!1)}};d.useEffect(()=>{const e=setTimeout(()=>{S()},300);return()=>clearTimeout(e)},[g,u,f,c.current_page]);const F=async(e,t,r)=>{var i,n;try{return(await k.put(`/admin/orders/${e}/status`,{status:t})).data.status==="success"?(S(),alert("Trạng thái đơn hàng đã được cập nhật thành công"),!0):!1}catch(s){console.error("Lỗi khi cập nhật trạng thái đơn hàng:",s),alert(((n=(i=s.response)==null?void 0:i.data)==null?void 0:n.message)||"Lỗi khi cập nhật trạng thái đơn hàng");const l=[...y],o=l.findIndex(h=>h.order_id.toString()===e);return o!==-1&&(l[o]={...l[o],order_status:r},x(l)),!1}},G=async e=>{const{destination:t,source:r,draggableId:i}=e;if(!(!t||t.droppableId===r.droppableId&&t.index===r.index)){if(m[t.droppableId]){alert("Không thể cập nhật sang trạng thái này qua Kanban");return}if(m[r.droppableId]){alert("Không thể di chuyển đơn hàng từ trạng thái này");return}if(t.droppableId!==r.droppableId){const n=i,s=t.droppableId,l=r.droppableId,o=[...y],h=o.findIndex(U=>U.order_id.toString()===n);h!==-1&&(o[h]={...o[h],order_status:s},x(o)),await F(n,s,l)}}},J=[{label:"Đóng gói đơn hàng",href:"/admin/orders"}],Q=e=>e?le(new Date(e),"dd/MM/yyyy"):"",p=y.reduce((e,t)=>{const r=t.order_status;return e[r]||(e[r]=[]),e[r].push(t),e},Object.keys(I).reduce((e,t)=>({...e,[t]:[]}),{})),O=({order:e,index:t,isReadOnly:r})=>a.jsx(re,{draggableId:e.order_id.toString(),index:t,isDragDisabled:r,children:(i,n)=>{var s;return a.jsx("div",{ref:i.innerRef,...i.draggableProps,...i.dragHandleProps,className:`mb-4 ${n.isDragging?"opacity-75":""}`,children:a.jsxs(Y,{className:`hover:shadow-md transition-shadow ${r?"border-l-4 border-l-gray-400":""}`,children:[a.jsxs(Z,{className:"pb-2 flex flex-row justify-between items-center",children:[a.jsxs(ee,{className:"text-sm font-semibold flex items-center",children:["#",e.order_id,r&&a.jsx(K,{className:"h-3 w-3 ml-1 text-gray-500"})]}),a.jsx(b,{className:q[e.payment_status]||"bg-gray-100",children:M[e.payment_status]||e.payment_status})]}),a.jsxs(ae,{className:"pt-0",children:[a.jsxs("div",{className:"text-sm mb-2",children:[a.jsx("div",{className:"font-medium",children:((s=e.user)==null?void 0:s.name)||"Khách hàng"}),a.jsx("div",{className:"text-gray-500",children:Q(e.order_date)})]}),a.jsx("div",{className:"flex justify-between items-center mt-2",children:a.jsxs(L,{variant:"outline",size:"sm",className:"text-blue-600 hover:text-blue-700",onClick:()=>z(e.order_id),children:[a.jsx(ie,{className:"h-4 w-4 mr-1"}),"Chi tiết"]})})]})]})})}},e.order_id);return a.jsxs(W,{children:[a.jsx(V,{title:"Đóng gói đơn hàng"}),a.jsxs("div",{className:"container mx-auto py-6 px-4",children:[a.jsx(X,{items:J}),a.jsx("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:a.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Đóng gói đơn hàng"})}),a.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden mb-6",children:a.jsxs("div",{className:"p-4 grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(ne,{className:"h-4 w-4 text-gray-500"}),a.jsx(N,{type:"text",placeholder:"Tìm kiếm đơn hàng...",value:g,onChange:e=>B(e.target.value),className:"w-full"})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(P,{className:"h-4 w-4 text-gray-500"}),a.jsx(N,{type:"date",value:u,onChange:e=>E(e.target.value),className:"w-full",placeholder:"Từ ngày"})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(P,{className:"h-4 w-4 text-gray-500"}),a.jsx(N,{type:"date",value:f,onChange:e=>$(e.target.value),className:"w-full",placeholder:"Đến ngày"})]})]})}),v?a.jsx("div",{className:"flex justify-center py-8",children:a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900"})}):a.jsx(te,{onDragEnd:G,children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 lg:grid-cols-4 gap-4",children:[Object.keys(j).map(e=>{var t;return a.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h2",{className:"font-semibold text-gray-700",children:a.jsx("span",{className:`px-2 py-1 rounded-full ${D[e]}`,children:j[e]})}),a.jsx(b,{variant:"outline",className:"bg-white",children:((t=p[e])==null?void 0:t.length)||0})]}),a.jsx(T,{droppableId:e,children:(r,i)=>{var n;return a.jsxs("div",{ref:r.innerRef,...r.droppableProps,className:`space-y-2 overflow-y-auto max-h-[calc(100vh-250px)] min-h-64 p-2 rounded-lg ${i.isDraggingOver?"bg-gray-100":"bg-gray-50"}`,children:[((n=p[e])==null?void 0:n.length)===0?a.jsx("div",{className:"text-center py-8 text-gray-500 bg-white rounded-lg border border-dashed border-gray-300",children:"Không có đơn hàng nào"}):p[e].map((s,l)=>a.jsx(O,{order:s,index:l,isReadOnly:!1},s.order_id)),r.placeholder]})}})]},e)}),Object.keys(m).map(e=>{var t;return a.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 relative",children:[a.jsx("div",{className:"absolute top-2 right-2",children:a.jsxs(b,{variant:"outline",className:"bg-gray-200 text-gray-700 flex items-center gap-1",children:[a.jsx(K,{className:"h-3 w-3"})," Chỉ xem"]})}),a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h2",{className:"font-semibold text-gray-700",children:a.jsx("span",{className:`px-2 py-1 rounded-full ${D[e]}`,children:m[e]})}),a.jsx(b,{variant:"outline",className:"bg-white",children:((t=p[e])==null?void 0:t.length)||0})]}),a.jsx(T,{droppableId:e,isDropDisabled:!0,children:(r,i)=>{var n;return a.jsxs("div",{ref:r.innerRef,...r.droppableProps,className:"space-y-2 overflow-y-auto max-h-[calc(100vh-250px)] min-h-64 p-2 rounded-lg bg-gray-100 opacity-90",children:[((n=p[e])==null?void 0:n.length)===0?a.jsx("div",{className:"text-center py-8 text-gray-500 bg-white rounded-lg border border-dashed border-gray-300",children:"Không có đơn hàng nào"}):p[e].map((s,l)=>a.jsx(O,{order:s,index:l,isReadOnly:!0},s.order_id)),r.placeholder]})}})]},e)})]})}),!v&&c.last_page>1&&a.jsx("div",{className:"flex justify-center mt-6",children:a.jsx("div",{className:"flex gap-2",children:Array.from({length:c.last_page},(e,t)=>t+1).map(e=>a.jsx(L,{variant:c.current_page===e?"default":"outline",className:"w-10 h-10",onClick:()=>C(t=>({...t,current_page:e})),children:e},e))})})]}),a.jsx(se,{orderId:A,isOpen:R,onClose:()=>_(!1)})]})}export{Me as default};
